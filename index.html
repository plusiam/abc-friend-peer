<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ì´ˆë“±í•™ìƒì„ ìœ„í•œ ABC ì¹œêµ¬ ë„ìš°ë¯¸ - ë˜ë˜ ìƒë‹´ ë„êµ¬">
    <meta name="keywords" content="ì´ˆë“±í•™ìƒ, ìƒë‹´, ì¹œêµ¬ ë„ìš°ë¯¸, ABC ìƒë‹´">
    <meta name="author" content="ABC Friend Helper">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="ABC ì¹œêµ¬ ë„ìš°ë¯¸ - ì´ˆë“±í•™ìƒ ë˜ë˜ ìƒë‹´ ë„êµ¬">
    <meta property="og:description" content="ì¹œêµ¬ì˜ ë§ˆìŒì„ ì´í•´í•˜ê³  ë„ì™€ì£¼ëŠ” 4ë‹¨ê³„ ìƒë‹´ ë„êµ¬">
    <meta property="og:type" content="website">
    
    <title>ABC ì¹œêµ¬ ë„ìš°ë¯¸ - ì´ˆë“±í•™ìƒ ë˜ë˜ ìƒë‹´ ë„êµ¬</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ - ìˆœì„œ ë³´ì¥ì„ ìœ„í•´ async ì œê±° -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- í•œê¸€ í°íŠ¸ preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS ë³€ìˆ˜ë¡œ ìƒ‰ìƒ ê´€ë¦¬ */
        :root {
            --color-stage1: #d1fae5;
            --color-stage1-dark: #065f46;
            --color-stage2: #dbeafe;
            --color-stage2-dark: #1e40af;
            --color-stage3: #ede9fe;
            --color-stage3-dark: #5b21b6;
            --color-stage4: #ffedd5;
            --color-stage4-dark: #9a3412;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc;
        }
        
        .title-font {
            font-family: 'Jua', sans-serif;
        }
        
        /* ê³µí†µ ìŠ¤íƒ€ì¼ */
        .btn-hover {
            transition: transform 0.2s ease;
        }
        
        .btn-hover:hover:not(:disabled) {
            transform: translateY(-2px);
        }
        
        .emotion-btn.selected {
            border-color: #10b981;
            background-color: #d1fae5;
            color: #065f46;
            font-weight: 600;
        }
        
        /* ë‹¨ê³„ë³„ ìŠ¤íƒ€ì¼ */
        .stage-title {
            border-radius: 12px;
            padding: 8px 16px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 12px;
            font-size: 1.2rem;
        }
        
        .stage1 { background-color: var(--color-stage1); color: var(--color-stage1-dark); }
        .stage2 { background-color: var(--color-stage2); color: var(--color-stage2-dark); }
        .stage3 { background-color: var(--color-stage3); color: var(--color-stage3-dark); }
        .stage4 { background-color: var(--color-stage4); color: var(--color-stage4-dark); }
        
        .card {
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            background-color: white;
            margin-bottom: 16px;
        }
        
        /* í¼ ìš”ì†Œ ìŠ¤íƒ€ì¼ */
        select, input, textarea {
            border-radius: 8px;
            padding: 8px 12px;
            border: 2px solid #e5e7eb;
            width: 100%;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
        }
        
        .preview-box {
            background: linear-gradient(to right, #d1fae5, #dbeafe);
            border-radius: 12px;
            padding: 16px;
            min-height: 60px;
            margin-bottom: 16px;
            border: 2px solid #10b981;
        }
        
        /* ë‹¨ê³„ ë„¤ë¹„ê²Œì´ì…˜ */
        .step-nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 24px;
            gap: 8px;
        }
        
        .step-btn {
            flex: 1;
            padding: 12px 8px;
            text-align: center;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            font-size: 0.9rem;
        }
        
        .step-btn.active {
            transform: translateY(-4px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .step-btn.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .step1-btn { background-color: var(--color-stage1); color: var(--color-stage1-dark); }
        .step1-btn.active { border-color: #059669; }
        
        .step2-btn { background-color: var(--color-stage2); color: var(--color-stage2-dark); }
        .step2-btn.active { border-color: #3b82f6; }
        
        .step3-btn { background-color: var(--color-stage3); color: var(--color-stage3-dark); }
        .step3-btn.active { border-color: #8b5cf6; }
        
        .step4-btn { background-color: var(--color-stage4); color: var(--color-stage4-dark); }
        .step4-btn.active { border-color: #f97316; }

        /* ì²´í¬ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 8px;
            border-radius: 8px;
            transition: background-color 0.2s;
            margin-bottom: 4px;
        }
        
        .checklist-item:hover {
            background-color: rgba(139, 92, 246, 0.05);
        }
        
        .checklist-item input[type="checkbox"] {
            margin: 0;
            width: auto;
            min-width: 16px;
            margin-top: 2px;
        }
        
        .checklist-item label {
            flex: 1;
            cursor: pointer;
            line-height: 1.4;
            color: #4b5563;
        }
        
        .checklist-section {
            background: rgba(139, 92, 246, 0.05);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }
        
        .checklist-title {
            font-weight: bold;
            color: #7c3aed;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        /* 3ë‹¨ê³„ ì „ìš© ìŠ¤íƒ€ì¼ */
        .step3-section {
            background: rgba(139, 92, 246, 0.03);
            border: 2px solid rgba(139, 92, 246, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .step3-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .step3-section-title {
            font-weight: bold;
            color: #7c3aed;
            font-size: 1.1rem;
        }

        .apply-btn {
            background: linear-gradient(135deg, #8b5cf6, #a78bfa);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(139, 92, 246, 0.2);
        }

        .apply-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(139, 92, 246, 0.3);
        }

        .apply-btn:active {
            transform: translateY(0);
        }

        .help-apply-btn {
            background: linear-gradient(135deg, #06b6d4, #67e8f9);
        }

        .help-apply-btn:hover {
            box-shadow: 0 4px 8px rgba(6, 182, 212, 0.3);
        }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        /* ì¸ì‡„ ìŠ¤íƒ€ì¼ - í¬ê²Œ ê°œì„  */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background-color: white !important;
                font-size: 12pt;
                line-height: 1.4;
                color: black !important;
            }
            
            .card {
                page-break-inside: avoid;
                box-shadow: none !important;
                border: 1px solid #ddd;
                background: white !important;
            }
            
            #result-screen {
                padding: 0 !important;
            }
            
            .title-font {
                font-size: 18pt !important;
                color: black !important;
            }
            
            /* ì¸ì‡„ìš© ìƒ‰ìƒ ì¡°ì • */
            .bg-green-50, .bg-blue-50, .bg-purple-50, .bg-orange-50, .bg-yellow-50 {
                background-color: #f5f5f5 !important;
            }
            
            .text-green-700, .text-blue-700, .text-purple-700, .text-orange-700 {
                color: black !important;
            }
            
            /* ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ ì¸ì‡„ ìµœì í™” */
            .grid {
                display: block !important;
            }
            
            .grid > div {
                display: block !important;
                margin-bottom: 10pt;
                page-break-inside: avoid;
            }
            
            /* í˜ì´ì§€ ì—¬ë°± */
            @page {
                margin: 1.5cm;
                size: A4;
            }
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .step-nav {
                flex-direction: column;
            }
            
            .step-btn {
                font-size: 0.8rem;
                padding: 8px 4px;
            }
            
            .card {
                padding: 12px;
            }
            
            .stage-title {
                font-size: 1rem;
                padding: 6px 12px;
            }

            .step3-section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .apply-btn {
                width: 100%;
                justify-self: stretch;
            }
        }
        
        @media (max-width: 480px) {
            .title-font {
                font-size: 1.5rem;
            }
            
            select, input, textarea {
                font-size: 16px; /* iOS ì¤Œ ë°©ì§€ */
            }
        }
        
        /* ë¡œë”© ìƒíƒœ */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        /* ì•Œë¦¼ ìŠ¤íƒ€ì¼ */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #10b981;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* PDF ì „ìš© ìŠ¤íƒ€ì¼ */
        .pdf-container {
            background: white;
            padding: 20px;
            font-family: 'Noto Sans KR', sans-serif;
            line-height: 1.6;
            color: #333;
        }

        /* ì‹¤ì œ ìƒí™© í‘œì‹œ ìŠ¤íƒ€ì¼ */
        .current-situation {
            background: linear-gradient(135deg, #fef3c7, #fed7aa);
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            font-weight: 500;
        }
    </style>
</head>
<body class="p-4">
    <div class="max-w-4xl mx-auto">
        <!-- í—¤ë” -->
        <header class="mb-6 text-center">
            <h1 class="text-3xl font-bold text-blue-600 title-font mb-2">ğŸŒˆ ABC ì¹œêµ¬ ë„ìš°ë¯¸</h1>
            <p class="text-gray-600">ì¹œêµ¬ì˜ ë§ˆìŒì„ ì´í•´í•˜ê³  ë„ì™€ì£¼ëŠ” 4ë‹¨ê³„ ìƒë‹´ ë„êµ¬</p>
            
            <!-- ì´ë¦„ ì…ë ¥ ì˜ì—­ -->
            <div class="max-w-2xl mx-auto mt-4 p-4 bg-white rounded-lg shadow-md">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ğŸ‘©â€ğŸ« ìƒë‹´ì ì´ë¦„</label>
                        <input type="text" id="counselor-name" placeholder="ìƒë‹´í•´ì£¼ëŠ” ì¹œêµ¬ ì´ë¦„" class="w-full p-2 border rounded-lg text-center">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">ğŸ‘¤ ìƒë‹´ë°›ëŠ” ì¹œêµ¬ ì´ë¦„</label>
                        <input type="text" id="client-name" placeholder="ë„ì›€ì´ í•„ìš”í•œ ì¹œêµ¬ ì´ë¦„" class="w-full p-2 border rounded-lg text-center">
                    </div>
                </div>
                
                <!-- ì´ˆê¸°í™” ë²„íŠ¼ -->
                <div class="mt-4 text-center">
                    <button id="reset-all-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold px-4 py-2 rounded-lg btn-hover text-sm">
                        ğŸ”„ ì „ì²´ ì´ˆê¸°í™”
                    </button>
                    <div class="text-xs text-gray-500 mt-1">ëª¨ë“  ë‚´ìš©ì„ ì§€ìš°ê³  ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤</div>
                </div>
            </div>
        </header>
        
        <!-- ë‹¨ê³„ ë„¤ë¹„ê²Œì´ì…˜ -->
        <nav class="step-nav no-print">
            <button class="step-btn step1-btn active" data-step="1">
                1ï¸âƒ£ ë§ˆìŒ ê³µê°í•˜ê¸°<br>
                <span class="text-xs">ì¹œêµ¬ ê°ì • ì´í•´í•˜ê¸°</span>
            </button>
            <button class="step-btn step2-btn disabled" data-step="2">
                2ï¸âƒ£ ê³µê° í‘œí˜„í•˜ê¸°<br>
                <span class="text-xs">ABCë¡œ ë”°ëœ»í•œ ë§í•˜ê¸°</span>
            </button>
            <button class="step-btn step3-btn disabled" data-step="3">
                3ï¸âƒ£ ë„ì›€ ì°¾ê¸°<br>
                <span class="text-xs">ìƒˆ ìƒê°ê³¼ í•´ê²°ë°©ë²•</span>
            </button>
            <button class="step-btn step4-btn disabled" data-step="4">
                4ï¸âƒ£ ê²©ë ¤í•˜ê¸°<br>
                <span class="text-xs">ì‘ì›ê³¼ ì‹¤ì²œ ì•½ì†</span>
            </button>
        </nav>

        <!-- ìƒë‹´ ë‚´ìš© ì…ë ¥ ì˜ì—­ -->
        <div class="card mb-6 no-print">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ­ ì¹œêµ¬ì˜ ê³ ë¯¼ì€ ë¬´ì—‡ì¸ê°€ìš”?</h2>
            
            <!-- ëª¨ë“œ ì„ íƒ ë²„íŠ¼ -->
            <div class="flex gap-4 mb-4">
                <button id="example-mode-btn" class="flex-1 bg-blue-500 text-white font-bold py-2 px-4 rounded-lg btn-hover">
                    ğŸ“‹ ê³ ë¯¼ ì‚¬ë¡€ ì„ íƒ
                </button>
                <button id="direct-mode-btn" class="flex-1 bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg btn-hover">
                    âœï¸ ì§ì ‘ ì…ë ¥í•˜ê¸°
                </button>
            </div>
            
            <!-- ê³ ë¯¼ ì‚¬ë¡€ ì„ íƒ ì˜ì—­ -->
            <div id="example-mode" class="input-mode">
                <label class="block text-gray-700 font-medium mb-2">ìì£¼ ìˆëŠ” ê³ ë¯¼ ì¤‘ì— ì„ íƒí•˜ê¸°:</label>
                <select id="worry-select" class="w-full p-3 border rounded-lg bg-white mb-4">
                    <option value="">ê³ ë¯¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”...</option>
                </select>
                
                <!-- ì„ íƒëœ ê³ ë¯¼ ABC í‘œì‹œ -->
                <div id="selected-worry-abc" class="bg-blue-50 p-4 rounded-lg mb-4 hidden">
                    <h3 class="font-bold text-blue-800 mb-2">ì„ íƒí•œ ê³ ë¯¼ ìƒí™©:</h3>
                    <div class="mb-1"><span class="text-red-500 font-bold">A(ì‚¬ì‹¤):</span> <span id="selected-a"></span></div>
                    <div class="mb-1"><span class="text-yellow-500 font-bold">B(ìƒê°):</span> <span id="selected-b"></span></div>
                    <div><span class="text-blue-500 font-bold">C(ê²°ê³¼):</span> <span id="selected-c"></span></div>
                </div>
            </div>
            
            <!-- ì§ì ‘ ì…ë ¥ ì˜ì—­ -->
            <div id="direct-mode" class="input-mode hidden">
                <div class="bg-blue-50 p-3 rounded-lg mb-3">
                    <p class="text-sm text-blue-700 mb-2 font-bold">ABCë¡œ ì¹œêµ¬ì˜ ê³ ë¯¼ ì •ë¦¬í•˜ê¸°:</p>
                    <div class="space-y-2">
                        <div>
                            <label class="text-sm text-red-500 font-bold">A(ì‚¬ì‹¤) - ë¬´ìŠ¨ ì¼ì´ ìˆì—ˆë‚˜ìš”?</label>
                            <textarea id="custom-a" rows="2" placeholder="ì˜ˆ: ì¹œêµ¬ê°€ ìƒì¼ íŒŒí‹°ì— ì´ˆëŒ€í•˜ì§€ ì•Šì•˜ì–´..." class="w-full"></textarea>
                        </div>
                        <div>
                            <label class="text-sm text-yellow-500 font-bold">B(ìƒê°) - ì–´ë–¤ ìƒê°ì´ ë“¤ì—ˆë‚˜ìš”?</label>
                            <textarea id="custom-b" rows="2" placeholder="ì˜ˆ: 'ë‚˜ë¥¼ ì‹«ì–´í•˜ë‚˜ë´. ì¹œêµ¬ë“¤ì´ ë‚˜ë§Œ ë¹¼ê³  ë†€ì•„...'" class="w-full"></textarea>
                        </div>
                        <div>
                            <label class="text-sm text-blue-500 font-bold">C(ê²°ê³¼) - ì–´ë–¤ ê°ì •ê³¼ í–‰ë™ì´ ë‚˜ì™”ë‚˜ìš”?</label>
                            <textarea id="custom-c" rows="2" placeholder="ì˜ˆ: ì†ìƒí•˜ê³  ì™¸ë¡œì› ì–´. ë‹¤ìŒ ë‚  í•™êµì— ê°€ê¸° ì‹«ì—ˆì–´..." class="w-full"></textarea>
                        </div>
                    </div>
                </div>
                <button id="custom-situation-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold px-4 py-2 rounded-lg btn-hover">
                    ê³ ë¯¼ ì €ì¥í•˜ê¸°
                </button>
            </div>
        </div>
        
        <!-- ë‹¨ê³„ë³„ ì»¨í…ì¸  ì»¨í…Œì´ë„ˆ -->
        <main id="step-content-container">
            <!-- 1ë‹¨ê³„: ë§ˆìŒ ê³µê°í•˜ê¸° -->
            <section id="step1" class="step-content">
                <div class="stage-title stage1">ğŸ’š 1ë‹¨ê³„: ë§ˆìŒ ê³µê°í•˜ê¸°</div>
                
                <div class="card">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-green-700">ğŸ­ ì¹œêµ¬ì˜ ë§ˆìŒì€ ì–´ë–¨ê¹Œìš”?</h3>
                        <button id="reset-emotions-btn" class="bg-gray-400 hover:bg-gray-500 text-white text-xs px-3 py-1 rounded btn-hover">
                            ğŸ”„ ê°ì • ì´ˆê¸°í™”
                        </button>
                    </div>
                    <div id="emotions-container" class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4">
                        <!-- ê°ì • ë²„íŠ¼ë“¤ì€ JSì—ì„œ ë™ì  ìƒì„± -->
                    </div>
                    
                    <div class="flex items-center gap-2 mb-2">
                        <input type="text" id="custom-emotion" placeholder="ë‹¤ë¥¸ ê°ì • ì§ì ‘ ì…ë ¥í•˜ê¸°" class="flex-1">
                        <button id="add-emotion-btn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg btn-hover whitespace-nowrap">
                            ì¶”ê°€í•˜ê¸°
                        </button>
                    </div>
                    
                    <div class="mb-2 text-sm text-gray-600">
                        ì„ íƒí•œ ê°ì •:
                    </div>
                    <div id="selected-emotions" class="flex flex-wrap gap-2 mb-4">
                        <span class="text-gray-400 italic">ì•„ì§ ì„ íƒëœ ê°ì •ì´ ì—†ìŠµë‹ˆë‹¤</span>
                    </div>
                </div>
                
                <div class="mt-6 text-center no-print">
                    <button id="next-to-step2" class="bg-blue-500 hover:bg-blue-600 text-white font-bold px-8 py-3 rounded-lg btn-hover text-lg">
                        ë‹¤ìŒ ë‹¨ê³„ë¡œ â†’
                    </button>
                </div>
            </section>
            
            <!-- 2ë‹¨ê³„: ê³µê° í‘œí˜„í•˜ê¸° -->
            <section id="step2" class="step-content hidden">
                <div class="stage-title stage2">ğŸ’¬ 2ë‹¨ê³„: ê³µê° í‘œí˜„í•˜ê¸°</div>
                
                <div class="card">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-blue-700">ğŸ’¬ ABCë¡œ ê³µê° í‘œí˜„ ë§Œë“¤ê¸°</h3>
                        <button id="reset-empathy-btn" class="bg-gray-400 hover:bg-gray-500 text-white text-xs px-3 py-1 rounded btn-hover">
                            ğŸ”„ ê³µê°í‘œí˜„ ì´ˆê¸°í™”
                        </button>
                    </div>
                    
                    <!-- í˜„ì¬ ìƒí™© í‘œì‹œ -->
                    <div id="current-situation-display" class="current-situation hidden">
                        <div class="font-bold text-orange-700 mb-2">ğŸ¯ í˜„ì¬ ìƒí™©:</div>
                        <div id="current-situation-text" class="text-gray-700"></div>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                        <div class="text-base md:text-lg font-medium text-blue-800 leading-relaxed">
                            <!-- A: ì‚¬ì‹¤/ìƒí™©ì€ ìë™ìœ¼ë¡œ í‘œì‹œë¨ -->
                            <div class="mb-3">
                                <label class="font-bold text-red-600 block mb-2">A - ì‚¬ì‹¤/ìƒí™© (ìë™ ì…ë ¥ë¨):</label>
                                <div id="auto-situation-display" class="bg-red-50 p-2 rounded text-red-700 text-sm">
                                    ë¨¼ì € ê³ ë¯¼ì„ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•´ì£¼ì„¸ìš”.
                                </div>
                            </div>
                            
                            <!-- B: ìƒê°/ì‹ ë… ì„ íƒ -->
                            <div class="mb-3">
                                <label class="font-bold text-yellow-600 block mb-2">B - ìƒê°/ì‹ ë… (ì„ íƒì‚¬í•­):</label>
                                <select id="thought-select" class="w-full p-2 border rounded bg-white">
                                    <option value="">ì„ íƒ ì•ˆí•¨</option>
                                </select>
                            </div>
                            
                            <!-- C: ê°ì •/ê²°ê³¼ ì„ íƒ -->
                            <div class="mb-3">
                                <label class="font-bold text-blue-600 block mb-2">C - ê°ì •/ê²°ê³¼ (ì„ íƒì‚¬í•­):</label>
                                <select id="feeling-select" class="w-full p-2 border rounded bg-white">
                                    <option value="">ì„ íƒ ì•ˆí•¨</option>
                                </select>
                            </div>
                            
                            <!-- ë§ˆë¬´ë¦¬ ë¬¸ì¥ -->
                            <div>
                                <label class="font-bold text-purple-600 block mb-2">ë§ˆë¬´ë¦¬ (ì„ íƒì‚¬í•­):</label>
                                <select id="closing-select" class="w-full p-2 border rounded bg-white">
                                    <option value="">ì„ íƒ ì•ˆí•¨</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ë¯¸ë¦¬ë³´ê¸° -->
                    <div>
                        <label class="font-bold text-gray-700 block mb-2">âœ¨ ì™„ì„±ëœ ê³µê° í‘œí˜„:</label>
                        <div id="empathy-preview" class="preview-box">
                            <span class="text-gray-500 italic">ìœ„ì—ì„œ ìƒí™©ì„ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ê³µê° í‘œí˜„ì´ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤</span>
                        </div>
                    </div>
                    
                    <!-- ìˆ˜ì • ê°€ëŠ¥í•œ ì…ë ¥ì°½ -->
                    <div>
                        <label class="font-bold text-gray-700 block mb-2">ğŸ“ í•„ìš”í•˜ë©´ ì§ì ‘ ìˆ˜ì •í•´ë³´ì„¸ìš”:</label>
                        <textarea id="empathy-text" rows="4" class="w-full" placeholder="ìœ„ì—ì„œ ìë™ ìƒì„±ëœ í‘œí˜„ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    
                    <!-- ìë™ ì™„ì„± ë²„íŠ¼ -->
                    <div class="text-center mt-4">
                        <button id="auto-complete-empathy" class="bg-blue-500 hover:bg-blue-600 text-white font-bold px-6 py-3 rounded-lg btn-hover text-lg pulse-animation">
                            âš¡ ì¶”ì²œ ê³µê° í‘œí˜„ ìë™ ìƒì„±í•˜ê¸°
                        </button>
                        <div class="text-xs text-gray-500 mt-2">í˜„ì¬ ìƒí™©ì— ë§ëŠ” ê³µê° í‘œí˜„ì„ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ë“œë ¤ìš”!</div>
                    </div>
                </div>
                
                <div class="mt-6 text-center flex justify-between no-print">
                    <button id="back-to-step1" class="bg-gray-500 hover:bg-gray-600 text-white font-bold px-6 py-3 rounded-lg btn-hover">
                        â† ì´ì „ ë‹¨ê³„ë¡œ
                    </button>
                    <button id="next-to-step3" class="bg-blue-500 hover:bg-blue-600 text-white font-bold px-8 py-3 rounded-lg btn-hover text-lg">
                        ë‹¤ìŒ ë‹¨ê³„ë¡œ â†’
                    </button>
                </div>
            </section>
            
            <!-- 3ë‹¨ê³„: ìƒˆë¡œìš´ ìƒê°ê³¼ ë„ì›€ ë°©ë²• ì°¾ê¸° -->
            <section id="step3" class="step-content hidden">
                <div class="stage-title stage3">âœ¨ 3ë‹¨ê³„: ë„ì›€ ì°¾ê¸°</div>
                
                <div class="card">
                    <h3 class="text-lg font-bold text-purple-700 mb-4">ğŸ’¡ ìƒˆë¡œìš´ ìƒê°ê³¼ ë„ì›€ ë°©ë²• ì°¾ê¸°</h3>
                    
                    <!-- ìƒˆë¡œìš´ ìƒê° ë§Œë“¤ê¸° ì„¹ì…˜ -->
                    <div class="step3-section">
                        <div class="step3-section-header">
                            <div class="step3-section-title">âœ¨ ë” ë„ì›€ì´ ë˜ëŠ” ìƒê° ë§Œë“¤ê¸°</div>
                            <button id="apply-thinking-checklist" class="apply-btn">
                                ğŸ“ ì„ íƒí•œ ìƒê°ë“¤ ì ìš©í•˜ê¸°
                            </button>
                        </div>
                        
                        <p class="text-sm text-gray-600 mb-3">ì¹œêµ¬ì˜ ë¶€ì •ì ì¸ ìƒê°ì„ ê¸ì •ì ì¸ ìƒê°ìœ¼ë¡œ ë°”ê¿”ë³´ì„¸ìš”</p>
                        
                        <!-- ìƒí™©ë³„ ìƒˆë¡œìš´ ìƒê° ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
                        <div id="thinking-checklist-container">
                            <!-- ì²´í¬ë¦¬ìŠ¤íŠ¸ëŠ” JSì—ì„œ ë™ì  ìƒì„± -->
                        </div>
                        
                        <textarea id="new-thinking" rows="3" class="w-full" placeholder="ì˜ˆ: 'í•œ ë²ˆì˜ ì‹œí—˜ìœ¼ë¡œ ëª¨ë“  ê²ƒì´ ê²°ì •ë˜ì§€ ì•Šì•„. ë‹¤ìŒì— ë” ì˜í•  ìˆ˜ ìˆì–´.'"></textarea>
                    </div>
                    
                    <!-- êµ¬ì²´ì ì¸ ë„ì›€ ë°©ë²• ì„¹ì…˜ -->
                    <div class="step3-section">
                        <div class="step3-section-header">
                            <div class="step3-section-title">ğŸ¯ êµ¬ì²´ì ì¸ ë„ì›€ ë°©ë²•</div>
                            <button id="apply-help-checklist" class="apply-btn help-apply-btn">
                                ğŸ¯ ì„ íƒí•œ ë°©ë²•ë“¤ ì ìš©í•˜ê¸°
                            </button>
                        </div>
                        
                        <p class="text-sm text-gray-600 mb-3">ì¹œêµ¬ê°€ ì‹¤ì œë¡œ í•  ìˆ˜ ìˆëŠ” í–‰ë™ì„ ì œì•ˆí•´ë³´ì„¸ìš”</p>
                        
                        <!-- ìƒí™©ë³„ ë„ì›€ ë°©ë²• ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
                        <div id="help-checklist-container">
                            <!-- ì²´í¬ë¦¬ìŠ¤íŠ¸ëŠ” JSì—ì„œ ë™ì  ìƒì„± -->
                        </div>
                        
                        <textarea id="help-suggestions" rows="3" class="w-full" placeholder="ì˜ˆ: 1) ì–´ë ¤ìš´ ë¬¸ì œëŠ” ì„ ìƒë‹˜ê»˜ ì§ˆë¬¸í•˜ê¸° 2) ë§¤ì¼ 15ë¶„ì”© ìˆ˜í•™ ë¬¸ì œ í’€ê¸°"></textarea>
                    </div>
                    
                    <div class="flex justify-center">
                        <button id="help-solutions-btn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold px-6 py-2 rounded-lg btn-hover">
                            ğŸ’¡ ë„ì›€ë§: í•´ê²°ì±… ì˜ˆì‹œ ë³´ê¸°
                        </button>
                    </div>
                </div>
                
                <div class="mt-6 text-center flex justify-between no-print">
                    <button id="back-to-step2" class="bg-gray-500 hover:bg-gray-600 text-white font-bold px-6 py-3 rounded-lg btn-hover">
                        â† ì´ì „ ë‹¨ê³„ë¡œ
                    </button>
                    <button id="next-to-step4" class="bg-blue-500 hover:bg-blue-600 text-white font-bold px-8 py-3 rounded-lg btn-hover text-lg">
                        ë‹¤ìŒ ë‹¨ê³„ë¡œ â†’
                    </button>
                </div>
            </section>
            
            <!-- 4ë‹¨ê³„: ê²©ë ¤í•˜ê¸° -->
            <section id="step4" class="step-content hidden">
                <div class="stage-title stage4">ğŸ 4ë‹¨ê³„: ê²©ë ¤í•˜ê¸°</div>
                
                <div class="card">
                    <h3 class="text-lg font-bold text-orange-700 mb-3">ğŸ’Œ ì¹œêµ¬ì—ê²Œ ë”°ëœ»í•œ ì‘ì› ì „í•˜ê¸°</h3>
                    
                    <div class="bg-orange-50 p-4 rounded-lg mb-4">
                        <!-- ê²©ë ¤ ë©”ì‹œì§€ ë½‘ê¸° -->
                        <div class="mb-4">
                            <button id="draw-encouragement-btn" class="bg-orange-500 hover:bg-orange-600 text-white font-bold px-6 py-2 rounded-lg btn-hover mb-3 w-full transition-all duration-300">
                                ğŸ² ê²©ë ¤ ë©”ì‹œì§€ ë½‘ê¸°
                            </button>
                            <div id="encouragement-message" class="bg-gradient-to-r from-orange-100 to-yellow-100 p-4 rounded-lg min-h-[80px] flex items-center justify-center text-orange-800 font-medium border-2 border-orange-200 text-center leading-relaxed shadow-inner relative">
                                ê²©ë ¤ ë©”ì‹œì§€ë¥¼ ë½‘ì•„ë³´ì„¸ìš”! ğŸ
                                <button id="favorite-message-btn" class="absolute top-2 right-2 text-yellow-500 hover:text-yellow-600 text-xl hidden" title="ì´ ë©”ì‹œì§€ ë§ˆìŒì— ë“¤ì–´ìš”!">
                                    â­
                                </button>
                            </div>
                            <div class="text-xs text-gray-500 mt-2 text-center">
                                ğŸ’¡ ì—¬ëŸ¬ ë²ˆ ëˆŒëŸ¬ì„œ ë‹¤ì–‘í•œ ë©”ì‹œì§€ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!
                            </div>
                        </div>
                        
                        <!-- ë‚˜ë§Œì˜ ê²©ë ¤ ë©”ì‹œì§€ -->
                        <div>
                            <label class="font-bold text-orange-700 block mb-2">ğŸ’ ë‚˜ë§Œì˜ ê²©ë ¤ ë©”ì‹œì§€:</label>
                            <textarea id="personal-encouragement" rows="3" class="w-full" placeholder="ì¹œêµ¬ì—ê²Œ ì „í•˜ê³  ì‹¶ì€ ë”°ëœ»í•œ ì‘ì›ì˜ ë§ì„ ì¨ë³´ì„¸ìš”..."></textarea>
                        </div>
                    </div>
                    
                    <!-- ì‹¤ì²œ ì•½ì† -->
                    <div class="mb-4">
                        <label class="font-bold text-gray-700 block mb-2">ğŸ¤ ì‹¤ì²œ ì•½ì†:</label>
                        <div class="bg-yellow-50 p-3 rounded-lg">
                            <label class="inline-flex items-center">
                                <input type="checkbox" id="promise-checkbox" class="form-checkbox h-5 w-5 text-orange-500">
                                <span class="ml-2 text-gray-700">ì•ìœ¼ë¡œ 2ì£¼ ë™ì•ˆ ì´ ì¹œêµ¬ë¥¼ íŠ¹ë³„íˆ ì‘ì›í•˜ê³  ë„ì™€ì¤„ê²Œìš”!</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 text-center flex justify-between no-print">
                    <button id="back-to-step3" class="bg-gray-500 hover:bg-gray-600 text-white font-bold px-6 py-3 rounded-lg btn-hover">
                        â† ì´ì „ ë‹¨ê³„ë¡œ
                    </button>
                    <button id="save-result-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold px-8 py-3 rounded-lg btn-hover text-lg">
                        ğŸ’¾ ìƒë‹´ ê²°ê³¼ ì €ì¥í•˜ê¸°
                    </button>
                </div>
            </section>
        </main>
        
        <!-- ê²°ê³¼ í™”ë©´ -->
        <section id="result-screen" class="hidden print-section">
            <div class="card">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-blue-600 title-font">ğŸŒˆ ABC ì¹œêµ¬ ë„ìš°ë¯¸ - ìƒë‹´ ê²°ê³¼</h2>
                    <p class="text-gray-600" id="result-date"></p>
                </div>
                
                <div id="result-content" class="space-y-4">
                    <!-- ê²°ê³¼ ë‚´ìš©ì€ ë™ì ìœ¼ë¡œ ìƒì„± -->
                </div>
            </div>
            
            <div class="mt-6 no-print">
                <div class="flex justify-center gap-2 flex-wrap">
                    <button id="download-image-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold px-4 py-2 md:px-6 md:py-3 rounded-lg btn-hover text-sm md:text-base">
                        ğŸ“· ì´ë¯¸ì§€ë¡œ ì €ì¥
                    </button>
                    <button id="download-pdf-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold px-4 py-2 md:px-6 md:py-3 rounded-lg btn-hover text-sm md:text-base">
                        ğŸ“„ PDFë¡œ ì €ì¥
                    </button>
                </div>
                <div class="flex justify-center gap-2 flex-wrap mt-2">
                    <button id="print-result-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold px-4 py-2 md:px-6 md:py-3 rounded-lg btn-hover text-sm md:text-base">
                        ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°
                    </button>
                    <button id="new-consultation-btn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold px-4 py-2 md:px-6 md:py-3 rounded-lg btn-hover text-sm md:text-base">
                        âœ¨ ìƒˆë¡œìš´ ìƒë‹´ ì‹œì‘
                    </button>
                </div>
            </div>
        </section>
    </div>
    
    <!-- ë„ì›€ë§ ëª¨ë‹¬ -->
    <div id="help-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg max-w-lg w-full p-6 max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800" id="modal-title">ë„ì›€ë§</h3>
                <button id="close-modal" class="text-gray-600 hover:text-gray-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="modal-content">
                <!-- ëª¨ë‹¬ ë‚´ìš©ì€ JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
            </div>
            <div class="mt-6 text-center">
                <button id="modal-close-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold px-6 py-2 rounded-lg">
                    ë‹«ê¸°
                </button>
            </div>
        </div>
    </div>
    
    <!-- ì•Œë¦¼ -->
    <div id="notification" class="notification">
        <span id="notification-text"></span>
    </div>
    
    <!-- JavaScript ëª¨ë“ˆí™” -->
    <script type="module">
        // ABC Helper ëª¨ë“ˆ
        const ABCHelper = {
            // ìƒíƒœ ê´€ë¦¬
            state: {
                currentStep: 1,
                selectedSituation: '',
                selectedEmotions: [],
                currentABC: { a: '', b: '', c: '' },
                consultationData: {},
                usedMessages: [],
                favoriteMessages: []
            },
            
            // ë°ì´í„°
            data: {
                emotions: ['ğŸ˜¢ ìŠ¬í””', 'ğŸ˜  í™”ë‚¨', 'ğŸ˜Ÿ ê±±ì •', 'ğŸ˜ ì‹¤ë§', 'ğŸ˜¨ ë‘ë ¤ì›€', 'ğŸ˜³ ë¶€ë„ëŸ¬ì›€', 'ğŸ˜” ì„œê¸€í””', 'ğŸ˜¤ ë‹µë‹µí•¨'],
                
                thoughts: ['ì •ë§ í˜ë“¤ì—ˆê² êµ¬ë‚˜', 'ë§ì´ ë‹¹í™©ìŠ¤ëŸ¬ì› ê² ì–´', 'ì–´ë–»ê²Œ í•´ì•¼ í• ì§€ ë§‰ë§‰í–ˆê² ì–´', 'ë§ˆìŒì´ ë³µì¡í–ˆê² êµ¬ë‚˜', 'ëˆ„êµ¬ë‚˜ ê·¸ëŸ° ìƒí™©ì´ë©´ ê·¸ë ‡ê²Œ ëŠë‚„ ìˆ˜ ìˆì–´'],
                
                feelings: ['ì†ìƒí•œ ë§ˆìŒì´ ë“¤ì—ˆê² ë‹¤', 'í™”ê°€ ë‚¬ê² ë‹¤', 'ê±±ì •ì´ ë§ì•˜ê² ë‹¤', 'ì‹¤ë§í–ˆê² ë‹¤', 'ë‘ë ¤ì› ê² ë‹¤', 'ë¶€ë„ëŸ¬ì› ê² ë‹¤', 'ì„œê¸€íê² ë‹¤', 'ë‹µë‹µí–ˆê² ë‹¤'],
                
                closings: ['ë„¤ ë§ˆìŒì„ ì´í•´í•´. í˜¼ìê°€ ì•„ë‹ˆì•¼.', 'ê·¸ëŸ° ê¸°ë¶„ì´ ë“œëŠ” ê±´ ìì—°ìŠ¤ëŸ¬ìš´ ê±°ì•¼.', 'ë„¤ ê°ì •ì€ ì¤‘ìš”í•´. ë” ì´ì•¼ê¸°í•´ì¤„ë˜?', 'í•¨ê»˜ ë°©ë²•ì„ ì°¾ì•„ë³´ì.', 'ì–¸ì œë“  ë‚´ê°€ ì˜†ì— ìˆì„ê²Œ.'],
                
                encouragementMessages: [
                    "ë„ˆì˜ ë§ˆìŒì„ ì´í•´í•´ì£¼ëŠ” ì‚¬ëŒì´ ì—¬ê¸° ìˆì–´ âœ¨",
                    "í˜ë“  ì‹œê°„ë„ ì§€ë‚˜ê°ˆ ê±°ì•¼, ì¡°ê¸ˆë§Œ ë” í˜ë‚´ì ğŸ’ª",
                    "ë„ˆëŠ” ìƒê°ë³´ë‹¤ í›¨ì”¬ ê°•í•œ ì‚¬ëŒì´ì•¼ ğŸŒŸ",
                    "ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ê´œì°®ì•„, ê·¸ê²ƒì´ ë°”ë¡œ ë„ˆë‹ˆê¹Œ ğŸ¤—",
                    "ì˜¤ëŠ˜ í•˜ë£¨ë„ ìµœì„ ì„ ë‹¤í•œ ë„ˆì—ê²Œ ë°•ìˆ˜ë¥¼ ë³´ë‚´ ğŸ‘"
                ],
                
                worryCases: {
                    "í•™êµìƒí™œ": [
                        { text: "ì‹œí—˜ ì„±ì ì´ ë‚˜ë¹ ì„œ ì†ìƒí•´", abc: { a: "ì—´ì‹¬íˆ ê³µë¶€í–ˆëŠ”ë° ì„±ì ì´ ìƒê°ë³´ë‹¤ ì•ˆ ì¢‹ê²Œ ë‚˜ì˜´", b: "ë…¸ë ¥í•´ë„ ì•ˆ ë˜ë‚˜ë´. ë¶€ëª¨ë‹˜ì´ ì‹¤ë§í•˜ì‹¤ ê±°ì•¼.", c: "ì†ìƒí•˜ê³  ë¶€ë„ëŸ¬ì›€. ì§‘ì— ê°€ê¸° ì‹«ìŒ." }},
                        { text: "ë°œí‘œí•˜ëŠ” ê²Œ ë„ˆë¬´ ë–¨ë ¤", abc: { a: "ë°œí‘œ ì‹œê°„ì— ì•ì— ë‚˜ê°€ë©´ ëª©ì†Œë¦¬ê°€ ë–¨ë¦¼", b: "ì‹¤ìˆ˜í•˜ë©´ ë‹¤ë“¤ ë‚  ë¹„ì›ƒì„ ê±°ì•¼. ë°”ë³´ì²˜ëŸ¼ ë³´ì¼ ê±°ì•¼.", c: "ì‹¬ì¥ì´ ë¹¨ë¦¬ ë›°ê³  ì†ì— ë•€ì´ ë‚¨. ë°œí‘œ ë‚ ì´ ë‘ë ¤ì›€." }},
                        { text: "ìƒˆ í•™ê¸‰ì— ì ì‘í•˜ê¸° ì–´ë ¤ì›Œ", abc: { a: "ìƒˆ í•™ê¸°ê°€ ë˜ì—ˆëŠ”ë° ì•„ì§ ì¹œí•œ ì¹œêµ¬ê°€ ì—†ìŒ", b: "ë‚˜ë‘ ê°™ì´ ìˆìœ¼ë©´ ì¬ë¯¸ì—†ë‚˜ë´. ê³„ì† í˜¼ìì¼ ê²ƒ ê°™ì•„.", c: "ì‰¬ëŠ” ì‹œê°„ê³¼ ì ì‹¬ì‹œê°„ì´ ë‘ë ¤ì›€. ì™¸ë¡­ê³  í•™êµ ê°€ê¸° ì‹«ìŒ." }}
                    ],
                    "ì¹œêµ¬ê´€ê³„": [
                        { text: "ì¹œêµ¬ì™€ ì‹¸ì› ì–´", abc: { a: "ì¹œêµ¬ê°€ ë‚´ ë¬¼ê±´ì„ í—ˆë½ ì—†ì´ ê°€ì ¸ê°€ê³  ì§œì¦ëƒ„", b: "ë‚˜ë¥¼ ë¬´ì‹œí•˜ëŠ” ê²ƒ ê°™ì•„. ì§„ì§œ ì¹œêµ¬ê°€ ë§ë‚˜?", c: "í™”ê°€ ë‚˜ì„œ ì†Œë¦¬ ì§€ë¦„. ì„œë¡œ ë§ì„ ì•ˆ í•˜ê²Œ ë¨." }},
                        { text: "ì¹œêµ¬ê°€ ë‚´ ë¹„ë°€ì„ ë‹¤ë¥¸ ì• í•œí…Œ ë§í–ˆì–´", abc: { a: "ì¹œêµ¬ì—ê²Œë§Œ ë§í•œ ë¹„ë°€ì´ ë‹¤ë¥¸ ì•„ì´ë“¤ì—ê²Œ í¼ì§", b: "ì¹œêµ¬ê°€ ë‚˜ë¥¼ ë°°ì‹ í–ˆì–´. ì•„ë¬´ë„ ë¯¿ì„ ìˆ˜ ì—†ì–´.", c: "ë°°ì‹ ê°ê³¼ ë¶„ë…¸ë¥¼ ëŠë‚Œ. ë” ì´ìƒ ë¹„ë°€ì„ ë§í•˜ì§€ ì•Šê¸°ë¡œ í•¨." }},
                        { text: "ì¹œêµ¬ë“¤ì´ ë‚˜ë§Œ ë¹¼ê³  ë…¼ ê²ƒ ê°™ì•„", abc: { a: "ì¹œêµ¬ë“¤ì´ ì£¼ë§ì— ëª¨ì˜€ëŠ”ë° ë‚˜ëŠ” ì´ˆëŒ€ë°›ì§€ ëª»í•¨", b: "ì¹œêµ¬ë“¤ì´ ë‚˜ë¥¼ ì‹«ì–´í•˜ë‚˜ë´. ë‚˜ëŠ” ì¸ê¸°ê°€ ì—†ë‚˜ë´.", c: "ì†Œì™¸ê°ê³¼ ì™¸ë¡œì›€ì„ ëŠë‚Œ. í•™êµ ê°€ê¸°ê°€ ë‘ë ¤ì›Œì§." }}
                    ],
                    "ê°€ì¡±ê´€ê³„": [
                        { text: "ë¶€ëª¨ë‹˜ì´ ë‚´ ë§ˆìŒì„ ëª°ë¼ì£¼ì‹œëŠ” ê²ƒ ê°™ì•„", abc: { a: "ë‚´ ê³ ë¯¼ì„ ë§í•´ë„ ë¶€ëª¨ë‹˜ì´ ëŒ€ìˆ˜ë¡­ì§€ ì•Šê²Œ ë„˜ê¸°ì‹¬", b: "ë¶€ëª¨ë‹˜ì€ ë‚´ ê°ì •ì— ê´€ì‹¬ì´ ì—†ì–´. ì–´ë¥¸ë“¤ì€ ì´í•´ ëª»í•´.", c: "ë‹µë‹µí•˜ê³  ì„œìš´í•¨. ë” ì´ìƒ ë§í•˜ì§€ ì•Šê²Œ ë¨." }},
                        { text: "ë™ìƒì´ë‘ ìê¾¸ ì‹¸ì›Œ", abc: { a: "ì‚¬ì†Œí•œ ì¼ë¡œ ë™ìƒê³¼ ìì£¼ ë‹¤íˆ¼", b: "ë™ìƒë§Œ ì˜ˆë»í•˜ì‹œëŠ” ê²ƒ ê°™ì•„. ì™œ ë‚˜ë§Œ ì–‘ë³´í•´ì•¼ í•´?", c: "í™”ê°€ ë‚˜ê³  ì–µìš¸í•¨. ê°€ì¡± ë¶„ìœ„ê¸°ê°€ ì•ˆ ì¢‹ì•„ì§." }}
                    ],
                    "ê°ì •ê³¼ ìì‹ ê°": [
                        { text: "ìê¾¸ ë¶ˆì•ˆí•œ ë§ˆìŒì´ ë“¤ì–´", abc: { a: "íŠ¹ë³„í•œ ì´ìœ  ì—†ì´ ìì£¼ ë¶ˆì•ˆê°ì„ ëŠë‚Œ", b: "ë­”ê°€ ë‚˜ìœ ì¼ì´ ìƒê¸¸ ê²ƒ ê°™ì•„. ë‚´ê°€ ì´ìƒí•œê°€?", c: "ì§‘ì¤‘í•˜ê¸° ì–´ë µê³  ì ì„ ì˜ ëª» ì . ì‘ì€ ì¼ì—ë„ ê±±ì •í•¨." }},
                        { text: "ë‚˜ë§Œ ì˜ ëª»í•˜ëŠ” ê²ƒ ê°™ì•„", abc: { a: "ì¹œêµ¬ë“¤ì€ ë‹¤ ì˜í•˜ëŠ”ë° ë‚˜ë§Œ ì‹¤ìˆ˜ë¥¼ ìì£¼ í•¨", b: "ë‚˜ëŠ” ì¬ëŠ¥ì´ ì—†ë‚˜ë´. ë…¸ë ¥í•´ë„ ì•ˆ ë  ê±°ì•¼.", c: "ìì‹ ê°ì´ ë–¨ì–´ì§€ê³  ë„ì „í•˜ê¸°ë¥¼ í”¼í•¨." }}
                    ]
                },

                // ìƒí™©ë³„ ë§ì¶¤ ì²´í¬ë¦¬ìŠ¤íŠ¸
                situationBasedChecklists: {
                    í•™êµìƒí™œ: {
                        thinking: [
                            "í•œ ë²ˆì˜ ì‹œí—˜ìœ¼ë¡œ ëª¨ë“  ê²ƒì´ ê²°ì •ë˜ì§€ ì•Šì•„",
                            "ì‹¤ìˆ˜ëŠ” ë°°ì›€ì˜ ê¸°íšŒê°€ ë  ìˆ˜ ìˆì–´", 
                            "ëª¨ë“  ì‚¬ëŒì€ ê°ìì˜ ì†ë„ê°€ ìˆì–´",
                            "ë…¸ë ¥í•˜ëŠ” ê³¼ì • ìì²´ê°€ ì†Œì¤‘í•´",
                            "ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ê´œì°®ì•„"
                        ],
                        help: [
                            "ì–´ë ¤ìš´ ë¬¸ì œëŠ” ì„ ìƒë‹˜ê»˜ ì§ˆë¬¸í•˜ê¸°",
                            "ë§¤ì¼ ì¡°ê¸ˆì”© ê³µë¶€ ê³„íš ì„¸ìš°ê¸°", 
                            "ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ê³µë¶€í•˜ê¸°",
                            "ì‘ì€ ëª©í‘œë¶€í„° ë‹¬ì„±í•´ë³´ê¸°",
                            "ì¶©ë¶„í•œ íœ´ì‹ ì·¨í•˜ê¸°"
                        ]
                    },
                    ì¹œêµ¬ê´€ê³„: {
                        thinking: [
                            "ì¹œêµ¬ë„ ì‹¤ìˆ˜í•  ìˆ˜ ìˆì–´",
                            "ëŒ€í™”ë¡œ í•´ê²°í•  ìˆ˜ ìˆì–´",
                            "ì§„ì§œ ì¹œêµ¬ëŠ” ì´í•´í•´ì¤„ ê±°ì•¼",
                            "í˜¼ìê°€ ì•„ë‹ˆì•¼, ë‹¤ë¥¸ ì¹œêµ¬ë“¤ë„ ìˆì–´",
                            "ì‹œê°„ì´ ì§€ë‚˜ë©´ ê´€ê³„ê°€ íšŒë³µë  ìˆ˜ ìˆì–´"
                        ],
                        help: [
                            "ì¹œêµ¬ì™€ ì†”ì§í•˜ê²Œ ëŒ€í™”í•˜ê¸°",
                            "ë¨¼ì € ì‚¬ê³¼í•˜ê±°ë‚˜ ì´í•´í•˜ë ¤ ë…¸ë ¥í•˜ê¸°",
                            "ìƒˆë¡œìš´ ì¹œêµ¬ ë§Œë“¤ì–´ë³´ê¸°",
                            "ì„ ìƒë‹˜ì´ë‚˜ ë¶€ëª¨ë‹˜ê»˜ ì¡°ì–¸ êµ¬í•˜ê¸°",
                            "ì¹œêµ¬ì˜ ì…ì¥ì—ì„œ ìƒê°í•´ë³´ê¸°"
                        ]
                    },
                    ê°€ì¡±ê´€ê³„: {
                        thinking: [
                            "ê°€ì¡±ë„ ì™„ë²½í•˜ì§€ ì•Šì•„",
                            "ì‹œê°„ì„ ë‘ê³  ëŒ€í™”í•˜ë©´ ì´í•´í•  ìˆ˜ ìˆì–´",
                            "ë‚´ ê°ì •ì„ í‘œí˜„í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•´",
                            "ê°€ì¡±ì€ ë‚˜ë¥¼ ì‚¬ë‘í•´",
                            "ì¡°ê¸ˆì”© ê´€ê³„ê°€ ë‚˜ì•„ì§ˆ ìˆ˜ ìˆì–´"
                        ],
                        help: [
                            "ì°¨ë¶„í•  ë•Œ ë§ˆìŒì„ ì „ë‹¬í•˜ê¸°",
                            "ê°€ì¡±ê³¼ í•¨ê»˜ ì‹œê°„ ë³´ë‚´ê¸°",
                            "ê°ì‚¬í•œ ë§ˆìŒ í‘œí˜„í•˜ê¸°",
                            "ì„œë¡œì˜ ì…ì¥ ì´í•´í•˜ë ¤ ë…¸ë ¥í•˜ê¸°",
                            "ê°€ì¡± íšŒì˜ ì‹œê°„ ë§Œë“¤ì–´ë³´ê¸°"
                        ]
                    },
                    ê°ì •ê³¼ìì‹ ê°: {
                        thinking: [
                            "ì´ëŸ° ê°ì •ì„ ëŠë¼ëŠ” ê±´ ìì—°ìŠ¤ëŸ¬ìš´ ê±°ì•¼",
                            "ì‹œê°„ì´ ì§€ë‚˜ë©´ ë‚˜ì•„ì§ˆ ê±°ì•¼",
                            "ë‚˜ë„ ì†Œì¤‘í•œ ì‚¬ëŒì´ì•¼",
                            "ë„ì›€ì„ ìš”ì²­í•˜ëŠ” ê²ƒì€ ìš©ê¸° ìˆëŠ” ì¼ì´ì•¼",
                            "ì‘ì€ ì„±ê³µë„ í° ì˜ë¯¸ê°€ ìˆì–´"
                        ],
                        help: [
                            "ë¯¿ì„ ë§Œí•œ ì–´ë¥¸ì—ê²Œ ì´ì•¼ê¸°í•˜ê¸°",
                            "ì¢‹ì•„í•˜ëŠ” í™œë™í•˜ë©° ê¸°ë¶„ ì „í™˜í•˜ê¸°",
                            "ê·œì¹™ì ì¸ ìƒí™œ ìŠµê´€ ë§Œë“¤ê¸°",
                            "ìì‹ ì˜ ì¥ì  ì°¾ì•„ë³´ê¸°",
                            "ì¶©ë¶„í•œ ìˆ˜ë©´ê³¼ íœ´ì‹ ì·¨í•˜ê¸°"
                        ]
                    }
                }
            },
            
            // ì´ˆê¸°í™”
            init() {
                this.loadWorryOptions();
                this.loadEmotionButtons();
                this.loadEmpathyOptions();
                this.attachEventListeners();
                this.restoreFromLocalStorage();
                console.log('ABC Helper ì´ˆê¸°í™” ì™„ë£Œ');
            },
            
            // ê³ ë¯¼ ì˜µì…˜ ë¡œë“œ
            loadWorryOptions() {
                const select = document.getElementById('worry-select');
                if (!select) return;
                
                Object.entries(this.data.worryCases).forEach(([category, cases]) => {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = category;
                    
                    cases.forEach(caseItem => {
                        const option = document.createElement('option');
                        option.value = caseItem.text;
                        option.textContent = caseItem.text;
                        option.dataset.abc = JSON.stringify(caseItem.abc);
                        option.dataset.category = category;
                        optgroup.appendChild(option);
                    });
                    
                    select.appendChild(optgroup);
                });
            },
            
            // ê°ì • ë²„íŠ¼ ë¡œë“œ
            loadEmotionButtons() {
                const container = document.getElementById('emotions-container');
                if (!container) return;
                
                this.data.emotions.forEach(emotion => {
                    const button = document.createElement('button');
                    button.className = 'emotion-btn p-2 border-2 border-gray-300 rounded-lg hover:border-green-500 text-sm';
                    button.textContent = emotion;
                    button.addEventListener('click', () => this.toggleEmotion(emotion));
                    container.appendChild(button);
                });
            },
            
            // ê³µê° í‘œí˜„ ì˜µì…˜ ë¡œë“œ
            loadEmpathyOptions() {
                this.loadSelectOptions('thought-select', this.data.thoughts);
                this.loadSelectOptions('feeling-select', this.data.feelings);
                this.loadSelectOptions('closing-select', this.data.closings);
            },
            
            // select ì˜µì…˜ ë¡œë“œ í—¬í¼
            loadSelectOptions(selectId, options) {
                const select = document.getElementById(selectId);
                if (!select) return;
                
                options.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option;
                    optionElement.textContent = option;
                    select.appendChild(optionElement);
                });
            },

            // ìƒí™©ë³„ ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
            loadSituationBasedChecklists(category) {
                // ì¹´í…Œê³ ë¦¬ ì •ê·œí™”
                const normalizedCategory = category?.replace(/\s+/g, '') || 'í•™êµìƒí™œ';
                const checklistData = this.data.situationBasedChecklists[normalizedCategory] || this.data.situationBasedChecklists['í•™êµìƒí™œ'];
                
                // ìƒˆë¡œìš´ ìƒê° ì²´í¬ë¦¬ìŠ¤íŠ¸
                const thinkingContainer = document.getElementById('thinking-checklist-container');
                if (thinkingContainer) {
                    thinkingContainer.innerHTML = `
                        <div class="checklist-section">
                            <div class="checklist-title">ğŸ’­ ${normalizedCategory} ìƒí™©ì— ë„ì›€ë˜ëŠ” ìƒê°ë“¤:</div>
                            ${checklistData.thinking.map((item, index) => `
                                <div class="checklist-item">
                                    <input type="checkbox" id="thinking-check-${index + 1}" class="thinking-checkbox">
                                    <label for="thinking-check-${index + 1}">${item}</label>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                // ë„ì›€ ë°©ë²• ì²´í¬ë¦¬ìŠ¤íŠ¸
                const helpContainer = document.getElementById('help-checklist-container');
                if (helpContainer) {
                    helpContainer.innerHTML = `
                        <div class="checklist-section">
                            <div class="checklist-title">ğŸ› ï¸ ${normalizedCategory} ìƒí™©ì— ë„ì›€ë˜ëŠ” ë°©ë²•ë“¤:</div>
                            ${checklistData.help.map((item, index) => `
                                <div class="checklist-item">
                                    <input type="checkbox" id="help-check-${index + 1}" class="help-checkbox">
                                    <label for="help-check-${index + 1}">${item}</label>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            },
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
            attachEventListeners() {
                // ëª¨ë“œ ì „í™˜
                this.addClickListener('example-mode-btn', () => this.switchInputMode('example'));
                this.addClickListener('direct-mode-btn', () => this.switchInputMode('direct'));
                
                // ê³ ë¯¼ ì„ íƒ
                this.addChangeListener('worry-select', (e) => this.selectWorry(e.target.value));
                
                // ì§ì ‘ ì…ë ¥ ì €ì¥
                this.addClickListener('custom-situation-btn', () => this.saveCustomSituation());
                
                // ê°ì • ì¶”ê°€
                this.addClickListener('add-emotion-btn', () => this.addCustomEmotion());
                
                // ê³µê° í‘œí˜„ - ì‚¬ìš©ì ì…ë ¥ ê¸°ë°˜ìœ¼ë¡œ ë³€ê²½
                this.addChangeListener('thought-select', () => this.updateEmpathyPreview());
                this.addChangeListener('feeling-select', () => this.updateEmpathyPreview());
                this.addChangeListener('closing-select', () => this.updateEmpathyPreview());
                this.addClickListener('auto-complete-empathy', () => this.autoCompleteEmpathy());
                
                // ì²´í¬ë¦¬ìŠ¤íŠ¸ ì ìš© ë²„íŠ¼
                this.addClickListener('apply-thinking-checklist', () => this.applyThinkingChecklist());
                this.addClickListener('apply-help-checklist', () => this.applyHelpChecklist());
                
                // ë‹¨ê³„ ì´ë™
                document.querySelectorAll('.step-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const step = parseInt(btn.dataset.step);
                        if (!btn.classList.contains('disabled')) {
                            this.goToStep(step);
                        }
                    });
                });
                
                // ë‹¤ìŒ/ì´ì „ ë²„íŠ¼
                this.addClickListener('next-to-step2', () => this.goToStep(2));
                this.addClickListener('back-to-step1', () => this.goToStep(1));
                this.addClickListener('next-to-step3', () => this.goToStep(3));
                this.addClickListener('back-to-step2', () => this.goToStep(2));
                this.addClickListener('next-to-step4', () => this.goToStep(4));
                this.addClickListener('back-to-step3', () => this.goToStep(3));
                
                // ì´ˆê¸°í™” ë²„íŠ¼
                this.addClickListener('reset-all-btn', () => this.resetAll());
                this.addClickListener('reset-emotions-btn', () => this.resetEmotions());
                this.addClickListener('reset-empathy-btn', () => this.resetEmpathy());
                
                // ê²©ë ¤ ë©”ì‹œì§€
                this.addClickListener('draw-encouragement-btn', () => this.drawEncouragement());
                this.addClickListener('favorite-message-btn', () => this.favoriteMessage());
                
                // ë„ì›€ë§
                this.addClickListener('help-solutions-btn', () => this.showSolutionsHelp());
                this.addClickListener('close-modal', () => this.hideModal());
                this.addClickListener('modal-close-btn', () => this.hideModal());
                
                // ê²°ê³¼ ì €ì¥ ë° ë‹¤ìš´ë¡œë“œ
                this.addClickListener('save-result-btn', () => this.saveAndShowResult());
                this.addClickListener('print-result-btn', () => this.printResult());
                this.addClickListener('download-image-btn', () => this.downloadAsImage());
                this.addClickListener('download-pdf-btn', () => this.downloadAsPDF());
                this.addClickListener('new-consultation-btn', () => this.startNewConsultation());
                
                // ìë™ ì €ì¥
                setInterval(() => this.autoSave(), 30000);
            },
            
            // ì²´í¬ë¦¬ìŠ¤íŠ¸ ì ìš© í•¨ìˆ˜ë“¤
            applyThinkingChecklist() {
                const checkedItems = [];
                document.querySelectorAll('.thinking-checkbox:checked').forEach(checkbox => {
                    const label = document.querySelector(`label[for="${checkbox.id}"]`);
                    if (label) {
                        checkedItems.push(label.textContent);
                    }
                });
                
                if (checkedItems.length > 0) {
                    const currentText = document.getElementById('new-thinking').value;
                    const newText = checkedItems.join('. ') + '.';
                    
                    if (currentText.trim()) {
                        document.getElementById('new-thinking').value = currentText + '\n\n' + newText;
                    } else {
                        document.getElementById('new-thinking').value = newText;
                    }
                    
                    // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
                    document.querySelectorAll('.thinking-checkbox').forEach(cb => cb.checked = false);
                    
                    this.showNotification('ğŸ’­ ì„ íƒí•œ ìƒê°ë“¤ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    this.showNotification('ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
                }
            },
            
            applyHelpChecklist() {
                const checkedItems = [];
                let counter = 1;
                
                document.querySelectorAll('.help-checkbox:checked').forEach(checkbox => {
                    const label = document.querySelector(`label[for="${checkbox.id}"]`);
                    if (label) {
                        checkedItems.push(`${counter}) ${label.textContent}`);
                        counter++;
                    }
                });
                
                if (checkedItems.length > 0) {
                    const currentText = document.getElementById('help-suggestions').value;
                    const newText = checkedItems.join('\n');
                    
                    if (currentText.trim()) {
                        document.getElementById('help-suggestions').value = currentText + '\n\n' + newText;
                    } else {
                        document.getElementById('help-suggestions').value = newText;
                    }
                    
                    // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
                    document.querySelectorAll('.help-checkbox').forEach(cb => cb.checked = false);
                    
                    this.showNotification('ğŸ¯ ì„ íƒí•œ ë°©ë²•ë“¤ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    this.showNotification('ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
                }
            },
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í—¬í¼
            addClickListener(id, handler) {
                const element = document.getElementById(id);
                if (element) element.addEventListener('click', handler);
            },
            
            addChangeListener(id, handler) {
                const element = document.getElementById(id);
                if (element) element.addEventListener('change', handler);
            },
            
            // ì…ë ¥ ëª¨ë“œ ì „í™˜
            switchInputMode(mode) {
                const exampleBtn = document.getElementById('example-mode-btn');
                const directBtn = document.getElementById('direct-mode-btn');
                const exampleMode = document.getElementById('example-mode');
                const directMode = document.getElementById('direct-mode');
                
                if (mode === 'example') {
                    exampleBtn.className = 'flex-1 bg-blue-500 text-white font-bold py-2 px-4 rounded-lg btn-hover';
                    directBtn.className = 'flex-1 bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg btn-hover';
                    exampleMode.classList.remove('hidden');
                    directMode.classList.add('hidden');
                } else {
                    directBtn.className = 'flex-1 bg-blue-500 text-white font-bold py-2 px-4 rounded-lg btn-hover';
                    exampleBtn.className = 'flex-1 bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg btn-hover';
                    directMode.classList.remove('hidden');
                    exampleMode.classList.add('hidden');
                }
            },
            
            // ê³ ë¯¼ ì„ íƒ
            selectWorry(worry) {
                if (!worry) {
                    document.getElementById('selected-worry-abc').classList.add('hidden');
                    this.state.selectedSituation = '';
                    this.state.currentABC = { a: '', b: '', c: '' };
                    this.updateCurrentSituation();
                    return;
                }
                
                const option = document.querySelector(`option[value="${worry}"]`);
                if (option && option.dataset.abc) {
                    const abc = JSON.parse(option.dataset.abc);
                    const category = option.dataset.category;
                    
                    document.getElementById('selected-a').textContent = abc.a;
                    document.getElementById('selected-b').textContent = abc.b;
                    document.getElementById('selected-c').textContent = abc.c;
                    document.getElementById('selected-worry-abc').classList.remove('hidden');
                    
                    this.state.selectedSituation = worry;
                    this.state.currentABC = abc;
                    this.state.currentCategory = category;
                    
                    this.clearPreviousContent();
                    this.autoSelectEmotions(worry);
                    this.updateCurrentSituation();
                    
                    // 3ë‹¨ê³„ì— ìƒí™©ë³„ ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
                    this.loadSituationBasedChecklists(category);
                }
            },

            // í˜„ì¬ ìƒí™© ì—…ë°ì´íŠ¸ - 2ë‹¨ê³„ì—ì„œ í‘œì‹œ
            updateCurrentSituation() {
                const display = document.getElementById('auto-situation-display');
                const currentSituation = this.state.currentABC.a || 'ë¨¼ì € ê³ ë¯¼ì„ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                
                if (display) {
                    display.textContent = currentSituation;
                    display.className = this.state.currentABC.a ? 
                        'bg-orange-50 p-2 rounded text-orange-700 text-sm' : 
                        'bg-red-50 p-2 rounded text-red-700 text-sm';
                }
                
                // ê³µê° í‘œí˜„ ë¯¸ë¦¬ë³´ê¸°ë„ ì—…ë°ì´íŠ¸
                this.updateEmpathyPreview();
            },
            
            // ì´ì „ ë‚´ìš© ì´ˆê¸°í™”
            clearPreviousContent() {
                this.state.selectedEmotions = [];
                document.querySelectorAll('.emotion-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                this.updateSelectedEmotions();
                
                // ë‹¤ë¥¸ ë‹¨ê³„ë“¤ë„ ì´ˆê¸°í™”
                document.getElementById('empathy-text').value = '';
                document.getElementById('new-thinking').value = '';
                document.getElementById('help-suggestions').value = '';
                document.getElementById('personal-encouragement').value = '';
                document.getElementById('promise-checkbox').checked = false;
                
                // ê³µê° í‘œí˜„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
                ['thought-select', 'feeling-select', 'closing-select'].forEach(id => {
                    const select = document.getElementById(id);
                    if (select) select.selectedIndex = 0;
                });
            },
            
            // ê°ì • ìë™ ì„ íƒ
            autoSelectEmotions(worry) {
                let recommendedEmotions = [];
                
                if (worry.includes('ì‹œí—˜') || worry.includes('ì„±ì ')) {
                    recommendedEmotions = ['ğŸ˜ ì‹¤ë§', 'ğŸ˜Ÿ ê±±ì •', 'ğŸ˜¢ ìŠ¬í””'];
                } else if (worry.includes('ì¹œêµ¬') && worry.includes('ì‹¸ì› ì–´')) {
                    recommendedEmotions = ['ğŸ˜  í™”ë‚¨', 'ğŸ˜ ì‹¤ë§', 'ğŸ˜” ì„œê¸€í””'];
                } else if (worry.includes('ë°œí‘œ')) {
                    recommendedEmotions = ['ğŸ˜¨ ë‘ë ¤ì›€', 'ğŸ˜Ÿ ê±±ì •', 'ğŸ˜³ ë¶€ë„ëŸ¬ì›€'];
                } else {
                    recommendedEmotions = ['ğŸ˜ ì‹¤ë§', 'ğŸ˜Ÿ ê±±ì •', 'ğŸ˜¢ ìŠ¬í””'];
                }
                
                recommendedEmotions.forEach(emotion => {
                    this.toggleEmotion(emotion, true);
                });
            },
            
            // ê°ì • í† ê¸€
            toggleEmotion(emotion, forceSelect = false) {
                const index = this.state.selectedEmotions.indexOf(emotion);
                
                if (forceSelect && index === -1) {
                    this.state.selectedEmotions.push(emotion);
                } else if (!forceSelect) {
                    if (index > -1) {
                        this.state.selectedEmotions.splice(index, 1);
                    } else {
                        this.state.selectedEmotions.push(emotion);
                    }
                }
                
                // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                document.querySelectorAll('.emotion-btn').forEach(btn => {
                    if (btn.textContent === emotion) {
                        btn.classList.toggle('selected', this.state.selectedEmotions.includes(emotion));
                    }
                });
                
                this.updateSelectedEmotions();
                this.updateStepButtons();
            },
            
            // ì„ íƒëœ ê°ì • ì—…ë°ì´íŠ¸
            updateSelectedEmotions() {
                const container = document.getElementById('selected-emotions');
                
                if (this.state.selectedEmotions.length === 0) {
                    container.innerHTML = '<span class="text-gray-400 italic">ì•„ì§ ì„ íƒëœ ê°ì •ì´ ì—†ìŠµë‹ˆë‹¤</span>';
                    return;
                }
                
                container.innerHTML = this.state.selectedEmotions.map(emotion => 
                    `<span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-sm flex items-center">
                        ${emotion}
                        <button onclick="ABCHelper.removeEmotion('${emotion}')" class="ml-1 text-green-600 hover:text-green-800">Ã—</button>
                    </span>`
                ).join('');
            },
            
            // ê°ì • ì œê±°
            removeEmotion(emotion) {
                this.toggleEmotion(emotion);
            },
            
            // ì»¤ìŠ¤í…€ ê°ì • ì¶”ê°€
            addCustomEmotion() {
                const input = document.getElementById('custom-emotion');
                const emotion = input.value.trim();
                
                if (!emotion) return;
                
                const emotionWithEmoji = `ğŸ˜Š ${emotion}`;
                
                if (!this.state.selectedEmotions.includes(emotionWithEmoji)) {
                    this.state.selectedEmotions.push(emotionWithEmoji);
                    this.updateSelectedEmotions();
                    input.value = '';
                    this.updateStepButtons();
                }
            },
            
            // ì§ì ‘ ì…ë ¥ ì €ì¥
            saveCustomSituation() {
                const customA = document.getElementById('custom-a').value.trim();
                const customB = document.getElementById('custom-b').value.trim();
                const customC = document.getElementById('custom-c').value.trim();
                
                if (!customA || !customB || !customC) {
                    alert('A, B, C ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    return;
                }
                
                this.state.selectedSituation = customA;
                this.state.currentABC = { a: customA, b: customB, c: customC };
                this.state.currentCategory = 'ê¸°íƒ€';
                
                this.clearPreviousContent();
                this.updateCurrentSituation();
                // ê¸°ë³¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
                this.loadSituationBasedChecklists('í•™êµìƒí™œ');
                alert('âœ… ê³ ë¯¼ì´ ì €ì¥ë˜ì—ˆì–´ìš”! ì´ì œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ì„¸ìš”.');
                this.goToStep(1);
            },
            
            // ê³µê° í‘œí˜„ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ - ê°œì„ ëœ ë²„ì „
            updateEmpathyPreview() {
                const thought = document.getElementById('thought-select').value;
                const feeling = document.getElementById('feeling-select').value;
                const closing = document.getElementById('closing-select').value;
                const currentSituation = this.state.currentABC.a;
                
                const preview = document.getElementById('empathy-preview');
                const textarea = document.getElementById('empathy-text');
                
                if (!currentSituation) {
                    preview.innerHTML = '<span class="text-gray-500 italic">ë¨¼ì € ìƒí™©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</span>';
                    return;
                }
                
                // ì„ íƒëœ ê²ƒë“¤ë§Œ ì¡°í•©
                const parts = [];
                
                // ìƒí™© ì„¤ëª…ìœ¼ë¡œ ì‹œì‘
                parts.push(`${currentSituation}ìœ¼ë¡œ`);
                
                if (thought) {
                    parts.push(thought);
                }
                
                if (feeling) {
                    parts.push(feeling);
                }
                
                if (closing) {
                    parts.push(closing);
                }
                
                // ìµœì†Œ ìƒí™©ì€ ìˆì–´ì•¼ í•¨
                if (parts.length > 0) {
                    const empathyText = parts.join('. ') + '.';
                    preview.innerHTML = empathyText;
                    textarea.value = empathyText;
                } else {
                    preview.innerHTML = '<span class="text-gray-500 italic">ìœ„ì—ì„œ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ê³µê° í‘œí˜„ì´ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤</span>';
                }
                
                this.updateStepButtons();
            },
            
            // ìë™ ê³µê° í‘œí˜„ ì™„ì„±
            autoCompleteEmpathy() {
                if (!this.state.currentABC.a) {
                    alert('ë¨¼ì € ê³ ë¯¼ ìƒí™©ì„ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    return;
                }
                
                // ê° ë“œë¡­ë‹¤ìš´ì—ì„œ ì²« ë²ˆì§¸ ì˜µì…˜(ì„ íƒ ì•ˆí•¨ ì œì™¸) ìë™ ì„ íƒ
                const selects = ['thought-select', 'feeling-select', 'closing-select'];
                
                selects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (!select.value && select.options.length > 1) {
                        select.selectedIndex = 1; // ì²« ë²ˆì§¸ ì‹¤ì œ ì˜µì…˜ ì„ íƒ
                    }
                });
                
                this.updateEmpathyPreview();
                
                const button = document.getElementById('auto-complete-empathy');
                button.textContent = 'âœ… ìë™ ì™„ì„±ë˜ì—ˆì–´ìš”!';
                button.classList.remove('pulse-animation');
                
                setTimeout(() => {
                    button.textContent = 'âš¡ ì¶”ì²œ ê³µê° í‘œí˜„ ìë™ ìƒì„±í•˜ê¸°';
                    button.classList.add('pulse-animation');
                }, 2000);
            },
            
            // ë‹¨ê³„ ì´ë™
            goToStep(step) {
                this.state.currentStep = step;
                
                // ëª¨ë“  ë‹¨ê³„ ìˆ¨ê¸°ê¸°
                document.querySelectorAll('.step-content').forEach(content => {
                    content.classList.add('hidden');
                });
                
                // í˜„ì¬ ë‹¨ê³„ í‘œì‹œ
                const currentStepElement = document.getElementById(`step${step}`);
                if (currentStepElement) {
                    currentStepElement.classList.remove('hidden');
                }
                
                // ë‹¨ê³„ ë²„íŠ¼ ì—…ë°ì´íŠ¸
                document.querySelectorAll('.step-btn').forEach(btn => {
                    const btnStep = parseInt(btn.dataset.step);
                    
                    btn.classList.remove('active');
                    
                    if (btnStep === step) {
                        btn.classList.add('active');
                    }
                    
                    if (btnStep < step) {
                        btn.classList.remove('disabled');
                    }
                    
                    if (btnStep > step + 1) {
                        btn.classList.add('disabled');
                    }
                });
                
                this.updateStepButtons();
                
                // 2ë‹¨ê³„ íŠ¹ë³„ ì²˜ë¦¬ - í˜„ì¬ ìƒí™© ì—…ë°ì´íŠ¸
                if (step === 2) {
                    this.updateCurrentSituation();
                }

                // 3ë‹¨ê³„ íŠ¹ë³„ ì²˜ë¦¬ - ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
                if (step === 3) {
                    const category = this.state.currentCategory || 'í•™êµìƒí™œ';
                    this.loadSituationBasedChecklists(category);
                }
            },
            
            // ë‹¨ê³„ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateStepButtons() {
                document.querySelectorAll('.step-btn').forEach(btn => {
                    const btnStep = parseInt(btn.dataset.step);
                    
                    if (btnStep === this.state.currentStep + 1) {
                        if (this.state.currentStep === 1) {
                            btn.classList.toggle('disabled', this.state.selectedEmotions.length === 0);
                        } else if (this.state.currentStep === 2) {
                            const empathyText = document.getElementById('empathy-text').value.trim();
                            btn.classList.toggle('disabled', !empathyText);
                        } else {
                            btn.classList.remove('disabled');
                        }
                    }
                });
            },
            
            // ê²©ë ¤ ë©”ì‹œì§€ ë½‘ê¸°
            drawEncouragement() {
                if (this.state.usedMessages.length >= this.data.encouragementMessages.length) {
                    this.state.usedMessages = [];
                }
                
                const availableMessages = this.data.encouragementMessages.filter(msg => 
                    !this.state.usedMessages.includes(msg)
                );
                
                const randomIndex = Math.floor(Math.random() * availableMessages.length);
                const selectedMessage = availableMessages[randomIndex];
                
                this.state.usedMessages.push(selectedMessage);
                
                const messageElement = document.getElementById('encouragement-message');
                const favoriteBtn = document.getElementById('favorite-message-btn');
                
                messageElement.style.opacity = '0.3';
                messageElement.style.transform = 'scale(0.9)';
                
                setTimeout(() => {
                    messageElement.textContent = selectedMessage;
                    messageElement.style.opacity = '1';
                    messageElement.style.transform = 'scale(1)';
                    messageElement.style.transition = 'all 0.3s ease';
                    
                    favoriteBtn.classList.remove('hidden');
                    messageElement.classList.add('pulse-animation');
                    
                    setTimeout(() => {
                        messageElement.classList.remove('pulse-animation');
                    }, 2000);
                }, 150);
                
                this.showNotification('ğŸ’Œ ë”°ëœ»í•œ ê²©ë ¤ ë©”ì‹œì§€ê°€ ë„ì°©í–ˆì–´ìš”!');
            },
            
            // ê²©ë ¤ ë©”ì‹œì§€ ì¦ê²¨ì°¾ê¸°
            favoriteMessage() {
                const messageElement = document.getElementById('encouragement-message');
                const currentMessage = messageElement.textContent;
                
                if (currentMessage && currentMessage !== 'ê²©ë ¤ ë©”ì‹œì§€ë¥¼ ë½‘ì•„ë³´ì„¸ìš”! ğŸ') {
                    if (!this.state.favoriteMessages.includes(currentMessage)) {
                        this.state.favoriteMessages.push(currentMessage);
                        
                        const favoriteBtn = document.getElementById('favorite-message-btn');
                        favoriteBtn.style.transform = 'scale(1.3)';
                        favoriteBtn.style.color = '#fbbf24';
                        
                        setTimeout(() => {
                            favoriteBtn.style.transform = 'scale(1)';
                        }, 200);
                        
                        this.showNotification('â­ ë©”ì‹œì§€ë¥¼ ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€í–ˆì–´ìš”!');
                    } else {
                        this.showNotification('ğŸ’« ì´ë¯¸ ì¦ê²¨ì°¾ê¸°í•œ ë©”ì‹œì§€ì˜ˆìš”!');
                    }
                }
            },
            
            // ê²°ê³¼ ì €ì¥ ë° í‘œì‹œ
            saveAndShowResult() {
                const counselorName = document.getElementById('counselor-name').value.trim() || 'ìƒë‹´ì';
                const clientName = document.getElementById('client-name').value.trim() || 'ìƒë‹´ë°›ëŠ” ì¹œêµ¬';
                
                this.state.consultationData = {
                    counselorName,
                    clientName,
                    situation: this.state.selectedSituation,
                    abc: this.state.currentABC,
                    emotions: this.state.selectedEmotions,
                    empathy: document.getElementById('empathy-text').value,
                    solutions: {
                        newThinking: document.getElementById('new-thinking').value,
                        helpSuggestions: document.getElementById('help-suggestions').value
                    },
                    encouragement: {
                        drawn: document.getElementById('encouragement-message').textContent,
                        personal: document.getElementById('personal-encouragement').value
                    },
                    promise: document.getElementById('promise-checkbox').checked,
                    timestamp: new Date().toLocaleString()
                };
                
                this.generateResultContent();
                
                // ê²°ê³¼ í™”ë©´ í‘œì‹œ
                document.querySelectorAll('.step-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById('result-screen').classList.remove('hidden');
                
                this.saveToLocalStorage();
                this.showNotification('ğŸ’¾ ìƒë‹´ ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
            },
            
            // ê²°ê³¼ ë‚´ìš© ìƒì„±
            generateResultContent() {
                const data = this.state.consultationData;
                
                document.getElementById('result-date').textContent = `ìƒë‹´ ì¼ì‹œ: ${data.timestamp}`;
                
                const resultContent = `
                    <div class="p-4 bg-gray-50 rounded-lg mb-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                            <div class="text-center">
                                <span class="font-semibold text-blue-600">ğŸ‘©â€ğŸ« ìƒë‹´ì:</span>
                                <span class="font-bold text-blue-800">${data.counselorName}</span>
                            </div>
                            <div class="text-center">
                                <span class="font-semibold text-green-600">ğŸ‘¤ ìƒë‹´ë°›ëŠ” ì¹œêµ¬:</span>
                                <span class="font-bold text-green-800">${data.clientName}</span>
                            </div>
                        </div>
                        <h3 class="font-bold text-lg text-gray-800 mb-2">ğŸ¯ ìƒë‹´ ì£¼ì œ</h3>
                        <p class="text-gray-700">${data.situation}</p>
                        
                        <div class="mt-3 bg-blue-50 p-3 rounded-lg">
                            <h4 class="font-bold text-blue-700 mb-1">ğŸ” ABC ë¶„ì„</h4>
                            <p><span class="text-red-500 font-semibold">A(ì‚¬ì‹¤):</span> ${data.abc.a || '(ì‘ì„±ë˜ì§€ ì•ŠìŒ)'}</p>
                            <p><span class="text-yellow-500 font-semibold">B(ìƒê°):</span> ${data.abc.b || '(ì‘ì„±ë˜ì§€ ì•ŠìŒ)'}</p>
                            <p><span class="text-blue-500 font-semibold">C(ê²°ê³¼):</span> ${data.abc.c || '(ì‘ì„±ë˜ì§€ ì•ŠìŒ)'}</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="p-4 bg-green-50 rounded-lg">
                            <h3 class="font-bold text-green-700 mb-2">ğŸ’š 1ë‹¨ê³„: ë§ˆìŒ ê³µê°í•˜ê¸°</h3>
                            <div class="mb-2">
                                <span class="font-semibold text-green-600">ì¹œêµ¬ì˜ ê°ì •:</span>
                                <div class="flex flex-wrap gap-1 mt-1">
                                    ${data.emotions.map(emotion => 
                                        `<span class="bg-green-100 px-2 py-1 rounded-full text-xs">${emotion}</span>`
                                    ).join('') || '<span class="text-gray-500 italic">ì„ íƒëœ ê°ì • ì—†ìŒ</span>'}
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-blue-50 rounded-lg">
                            <h3 class="font-bold text-blue-700 mb-2">ğŸ’¬ 2ë‹¨ê³„: ê³µê° í‘œí˜„í•˜ê¸°</h3>
                            <div>
                                <span class="font-semibold text-blue-600">ê³µê° í‘œí˜„:</span>
                                <p class="bg-white p-2 rounded mt-1 text-sm">${data.empathy || '(ì‘ì„±ë˜ì§€ ì•ŠìŒ)'}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="p-4 bg-purple-50 rounded-lg">
                            <h3 class="font-bold text-purple-700 mb-2">âœ¨ 3ë‹¨ê³„: ë„ì›€ ì°¾ê¸°</h3>
                            <div class="space-y-2">
                                <div>
                                    <span class="font-semibold text-purple-600">ìƒˆë¡œìš´ ìƒê°:</span>
                                    <p class="bg-white p-2 rounded mt-1 text-sm">${data.solutions.newThinking || '(ì‘ì„±ë˜ì§€ ì•ŠìŒ)'}</p>
                                </div>
                                <div>
                                    <span class="font-semibold text-purple-600">êµ¬ì²´ì ì¸ ë„ì›€ ë°©ë²•:</span>
                                    <p class="bg-white p-2 rounded mt-1 text-sm whitespace-pre-line">${data.solutions.helpSuggestions || '(ì‘ì„±ë˜ì§€ ì•ŠìŒ)'}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-orange-50 rounded-lg">
                            <h3 class="font-bold text-orange-700 mb-2">ğŸ 4ë‹¨ê³„: ê²©ë ¤í•˜ê¸°</h3>
                            <div class="space-y-2">
                                ${data.encouragement.drawn && data.encouragement.drawn !== 'ê²©ë ¤ ë©”ì‹œì§€ë¥¼ ë½‘ì•„ë³´ì„¸ìš”! ğŸ' ? `
                                    <div>
                                        <span class="font-semibold text-orange-600">ê²©ë ¤ ë©”ì‹œì§€:</span>
                                        <p class="bg-gradient-to-r from-orange-100 to-yellow-100 p-2 rounded mt-1 text-sm">${data.encouragement.drawn}</p>
                                    </div>
                                ` : ''}
                                <div>
                                    <span class="font-semibold text-orange-600">ë‚˜ë§Œì˜ ê²©ë ¤ ë©”ì‹œì§€:</span>
                                    <p class="bg-white p-2 rounded mt-1 text-sm">${data.encouragement.personal || '(ì‘ì„±ë˜ì§€ ì•ŠìŒ)'}</p>
                                </div>
                                <div class="mt-3">
                                    ${data.promise ? 
                                        '<span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full">ğŸ¤ ì•ìœ¼ë¡œ 2ì£¼ ë™ì•ˆ ì´ ì¹œêµ¬ë¥¼ íŠ¹ë³„íˆ ì‘ì›í•˜ê³  ë„ì™€ì¤„ê²Œìš”!</span>' : 
                                        ''
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                        <div class="flex justify-center items-center">
                            <span class="text-yellow-700 font-bold text-lg">ğŸŒŸ ì¹œêµ¬ë¥¼ ë„ì™€ì¤˜ì„œ ì •ë§ ë©‹ì ¸ìš”! ğŸŒŸ</span>
                        </div>
                    </div>
                `;
                
                document.getElementById('result-content').innerHTML = resultContent;
            },

            // ì¸ì‡„ ê¸°ëŠ¥ ê°œì„ 
            printResult() {
                window.print();
            },
            
            // ì´ë¯¸ì§€ë¡œ ë‹¤ìš´ë¡œë“œ - ê°œì„ ëœ ë²„ì „
            async downloadAsImage() {
                if (typeof html2canvas === 'undefined') {
                    this.showNotification('â³ ì´ë¯¸ì§€ ìƒì„± ë„êµ¬ë¥¼ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤...');
                    // ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
                    let attempts = 0;
                    while (typeof html2canvas === 'undefined' && attempts < 30) {
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        attempts++;
                    }
                    
                    if (typeof html2canvas === 'undefined') {
                        alert('ì´ë¯¸ì§€ ìƒì„± ê¸°ëŠ¥ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                        return;
                    }
                }
                
                try {
                    this.showNotification('ğŸ“· ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...');
                    
                    const resultElement = document.getElementById('result-screen');
                    const buttons = resultElement.querySelector('.no-print');
                    
                    // ë²„íŠ¼ ì„ì‹œ ìˆ¨ê¸°ê¸°
                    if (buttons) buttons.style.display = 'none';
                    
                    const canvas = await html2canvas(resultElement, {
                        scale: 2,
                        logging: false,
                        useCORS: true,
                        backgroundColor: '#ffffff',
                        width: resultElement.scrollWidth,
                        height: resultElement.scrollHeight
                    });
                    
                    const link = document.createElement('a');
                    link.download = `ABCì¹œêµ¬ë„ìš°ë¯¸_ìƒë‹´ê²°ê³¼_${new Date().toISOString().split('T')[0]}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    
                    // ë²„íŠ¼ ë‹¤ì‹œ í‘œì‹œ
                    if (buttons) buttons.style.display = '';
                    
                    this.showNotification('ğŸ“· ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
                } catch (error) {
                    console.error('ì´ë¯¸ì§€ ìƒì„± ì˜¤ë¥˜:', error);
                    alert('ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    
                    // ë²„íŠ¼ ë‹¤ì‹œ í‘œì‹œ
                    const buttons = document.querySelector('#result-screen .no-print');
                    if (buttons) buttons.style.display = '';
                }
            },
            
            // PDFë¡œ ë‹¤ìš´ë¡œë“œ - í¬ê²Œ ê°œì„ ëœ ë²„ì „
            async downloadAsPDF() {
                if (typeof window.jspdf === 'undefined') {
                    this.showNotification('â³ PDF ìƒì„± ë„êµ¬ë¥¼ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤...');
                    // ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
                    let attempts = 0;
                    while (typeof window.jspdf === 'undefined' && attempts < 30) {
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        attempts++;
                    }
                    
                    if (typeof window.jspdf === 'undefined') {
                        alert('PDF ìƒì„± ê¸°ëŠ¥ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                        return;
                    }
                }
                
                try {
                    this.showNotification('ğŸ“„ PDFë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...');
                    
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF('p', 'mm', 'a4');
                    const data = this.state.consultationData;
                    
                    // ì—¬ë°± ì„¤ì •
                    const margin = 20;
                    const pageWidth = 210 - (margin * 2);
                    let currentY = margin;
                    
                    // ì œëª©
                    doc.setFontSize(18);
                    doc.text('ğŸŒˆ ABC ì¹œêµ¬ ë„ìš°ë¯¸ - ìƒë‹´ ê²°ê³¼', margin, currentY);
                    currentY += 10;
                    
                    // ë‚ ì§œ
                    doc.setFontSize(10);
                    doc.text(`ìƒë‹´ ì¼ì‹œ: ${data.timestamp}`, margin, currentY);
                    currentY += 15;
                    
                    // ê¸°ë³¸ ì •ë³´
                    doc.setFontSize(12);
                    doc.text(`ìƒë‹´ì: ${data.counselorName}`, margin, currentY);
                    doc.text(`ìƒë‹´ë°›ëŠ” ì¹œêµ¬: ${data.clientName}`, margin + 90, currentY);
                    currentY += 10;
                    
                    // ìƒë‹´ ì£¼ì œ
                    doc.setFontSize(11);
                    doc.text('ğŸ¯ ìƒë‹´ ì£¼ì œ', margin, currentY);
                    currentY += 6;
                    const splitSituation = doc.splitTextToSize(data.situation, pageWidth);
                    doc.text(splitSituation, margin, currentY);
                    currentY += splitSituation.length * 5 + 10;
                    
                    // ABC ë¶„ì„
                    doc.text('ğŸ” ABC ë¶„ì„', margin, currentY);
                    currentY += 8;
                    
                    doc.setFontSize(10);
                    const abcData = [
                        `A(ì‚¬ì‹¤): ${data.abc.a || '(ì‘ì„±ë˜ì§€ ì•ŠìŒ)'}`,
                        `B(ìƒê°): ${data.abc.b || '(ì‘ì„±ë˜ì§€ ì•ŠìŒ)'}`,
                        `C(ê²°ê³¼): ${data.abc.c || '(ì‘ì„±ë˜ì§€ ì•ŠìŒ)'}`
                    ];
                    
                    abcData.forEach(item => {
                        const splitText = doc.splitTextToSize(item, pageWidth);
                        doc.text(splitText, margin, currentY);
                        currentY += splitText.length * 4 + 3;
                    });
                    currentY += 10;
                    
                    // 1ë‹¨ê³„: ë§ˆìŒ ê³µê°í•˜ê¸°
                    doc.setFontSize(11);
                    doc.text('ğŸ’š 1ë‹¨ê³„: ë§ˆìŒ ê³µê°í•˜ê¸°', margin, currentY);
                    currentY += 6;
                    doc.setFontSize(10);
                    const emotions = data.emotions.length > 0 ? data.emotions.join(', ') : 'ì„ íƒëœ ê°ì • ì—†ìŒ';
                    const splitEmotions = doc.splitTextToSize(`ì¹œêµ¬ì˜ ê°ì •: ${emotions}`, pageWidth);
                    doc.text(splitEmotions, margin, currentY);
                    currentY += splitEmotions.length * 4 + 8;
                    
                    // 2ë‹¨ê³„: ê³µê° í‘œí˜„í•˜ê¸°
                    doc.setFontSize(11);
                    doc.text('ğŸ’¬ 2ë‹¨ê³„: ê³µê° í‘œí˜„í•˜ê¸°', margin, currentY);
                    currentY += 6;
                    doc.setFontSize(10);
                    const empathy = data.empathy || '(ì‘ì„±ë˜ì§€ ì•ŠìŒ)';
                    const splitEmpathy = doc.splitTextToSize(empathy, pageWidth);
                    doc.text(splitEmpathy, margin, currentY);
                    currentY += splitEmpathy.length * 4 + 8;
                    
                    // ìƒˆ í˜ì´ì§€ê°€ í•„ìš”í•œì§€ í™•ì¸
                    if (currentY > 250) {
                        doc.addPage();
                        currentY = margin;
                    }
                    
                    // 3ë‹¨ê³„: ë„ì›€ ì°¾ê¸°
                    doc.setFontSize(11);
                    doc.text('âœ¨ 3ë‹¨ê³„: ë„ì›€ ì°¾ê¸°', margin, currentY);
                    currentY += 8;
                    
                    doc.setFontSize(10);
                    doc.text('ìƒˆë¡œìš´ ìƒê°:', margin, currentY);
                    currentY += 4;
                    const newThinking = data.solutions.newThinking || '(ì‘ì„±ë˜ì§€ ì•ŠìŒ)';
                    const splitThinking = doc.splitTextToSize(newThinking, pageWidth);
                    doc.text(splitThinking, margin, currentY);
                    currentY += splitThinking.length * 4 + 6;
                    
                    doc.text('êµ¬ì²´ì ì¸ ë„ì›€ ë°©ë²•:', margin, currentY);
                    currentY += 4;
                    const helpSuggestions = data.solutions.helpSuggestions || '(ì‘ì„±ë˜ì§€ ì•ŠìŒ)';
                    const splitHelp = doc.splitTextToSize(helpSuggestions, pageWidth);
                    doc.text(splitHelp, margin, currentY);
                    currentY += splitHelp.length * 4 + 8;
                    
                    // 4ë‹¨ê³„: ê²©ë ¤í•˜ê¸°
                    doc.setFontSize(11);
                    doc.text('ğŸ 4ë‹¨ê³„: ê²©ë ¤í•˜ê¸°', margin, currentY);
                    currentY += 8;
                    
                    doc.setFontSize(10);
                    if (data.encouragement.drawn && data.encouragement.drawn !== 'ê²©ë ¤ ë©”ì‹œì§€ë¥¼ ë½‘ì•„ë³´ì„¸ìš”! ğŸ') {
                        doc.text('ê²©ë ¤ ë©”ì‹œì§€:', margin, currentY);
                        currentY += 4;
                        const splitDrawn = doc.splitTextToSize(data.encouragement.drawn, pageWidth);
                        doc.text(splitDrawn, margin, currentY);
                        currentY += splitDrawn.length * 4 + 4;
                    }
                    
                    doc.text('ë‚˜ë§Œì˜ ê²©ë ¤ ë©”ì‹œì§€:', margin, currentY);
                    currentY += 4;
                    const personal = data.encouragement.personal || '(ì‘ì„±ë˜ì§€ ì•ŠìŒ)';
                    const splitPersonal = doc.splitTextToSize(personal, pageWidth);
                    doc.text(splitPersonal, margin, currentY);
                    currentY += splitPersonal.length * 4 + 6;
                    
                    if (data.promise) {
                        doc.text('ğŸ¤ ì•ìœ¼ë¡œ 2ì£¼ ë™ì•ˆ ì´ ì¹œêµ¬ë¥¼ íŠ¹ë³„íˆ ì‘ì›í•˜ê³  ë„ì™€ì¤„ê²Œìš”!', margin, currentY);
                        currentY += 8;
                    }
                    
                    // ë§ˆë¬´ë¦¬ ë©”ì‹œì§€
                    doc.setFontSize(12);
                    doc.text('ğŸŒŸ ì¹œêµ¬ë¥¼ ë„ì™€ì¤˜ì„œ ì •ë§ ë©‹ì ¸ìš”! ğŸŒŸ', margin, currentY + 10);
                    
                    // PDF ë‹¤ìš´ë¡œë“œ
                    doc.save(`ABCì¹œêµ¬ë„ìš°ë¯¸_ìƒë‹´ê²°ê³¼_${new Date().toISOString().split('T')[0]}.pdf`);
                    
                    this.showNotification('ğŸ“„ PDFê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
                } catch (error) {
                    console.error('PDF ìƒì„± ì˜¤ë¥˜:', error);
                    alert('PDF ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            },
            
            // ìƒˆë¡œìš´ ìƒë‹´ ì‹œì‘
            startNewConsultation() {
                if (confirm('ìƒˆë¡œìš´ ìƒë‹´ì„ ì‹œì‘í•˜ì‹œê² ì–´ìš”? í˜„ì¬ ë‚´ìš©ì€ ëª¨ë‘ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.')) {
                    this.resetAll();
                    document.getElementById('result-screen').classList.add('hidden');
                    this.goToStep(1);
                }
            },
            
            // ì „ì²´ ì´ˆê¸°í™”
            resetAll() {
                // ìƒíƒœ ì´ˆê¸°í™”
                this.state = {
                    currentStep: 1,
                    selectedSituation: '',
                    selectedEmotions: [],
                    currentABC: { a: '', b: '', c: '' },
                    consultationData: {},
                    usedMessages: [],
                    favoriteMessages: []
                };
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.querySelectorAll('input[type="text"], textarea').forEach(el => {
                    el.value = '';
                });
                
                document.querySelectorAll('input[type="checkbox"]').forEach(el => {
                    el.checked = false;
                });
                
                document.querySelectorAll('select').forEach(select => {
                    select.selectedIndex = 0;
                });
                
                // UI ì´ˆê¸°í™”
                document.querySelectorAll('.emotion-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                this.updateSelectedEmotions();
                this.updateCurrentSituation();
                this.switchInputMode('example');
                
                // ê¸°ë³¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
                this.loadSituationBasedChecklists('í•™êµìƒí™œ');
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚­ì œ
                localStorage.removeItem('abc_friend_helper_data');
                
                this.showNotification('ğŸ”„ ì „ì²´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
            },
            
            // ê°ì • ì´ˆê¸°í™”
            resetEmotions() {
                if (confirm('ì„ íƒí•œ ê°ì •ì„ ëª¨ë‘ ì§€ìš°ì‹œê² ì–´ìš”?')) {
                    this.state.selectedEmotions = [];
                    document.querySelectorAll('.emotion-btn').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                    document.getElementById('custom-emotion').value = '';
                    this.updateSelectedEmotions();
                    this.updateStepButtons();
                    this.showNotification('ğŸ”„ ê°ì • ì„ íƒì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            },
            
            // ê³µê° í‘œí˜„ ì´ˆê¸°í™”
            resetEmpathy() {
                if (confirm('ì‘ì„±í•œ ê³µê° í‘œí˜„ì„ ì§€ìš°ì‹œê² ì–´ìš”?')) {
                    document.querySelectorAll('#thought-select, #feeling-select, #closing-select').forEach(select => {
                        select.selectedIndex = 0;
                    });
                    document.getElementById('empathy-text').value = '';
                    this.updateEmpathyPreview();
                    this.updateStepButtons();
                    this.showNotification('ğŸ”„ ê³µê° í‘œí˜„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            },
            
            // ë„ì›€ë§ í‘œì‹œ
            showSolutionsHelp() {
                const modal = document.getElementById('help-modal');
                document.getElementById('modal-title').textContent = 'í•´ê²°ì±… ë„ì›€ë§';
                document.getElementById('modal-content').innerHTML = `
                    <div class="space-y-4">
                        <p class="text-gray-700">ì¹œêµ¬ê°€ ìì‹ ì˜ ìƒí™©ì„ ë” ê¸ì •ì ìœ¼ë¡œ ë°”ë¼ë³´ê³  êµ¬ì²´ì ì¸ í–‰ë™ì„ í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ì„¸ìš”:</p>
                        
                        <div class="bg-purple-50 p-3 rounded-lg">
                            <h4 class="font-bold text-purple-600 mb-1">âœ¨ ìƒˆë¡œìš´ ìƒê° ì˜ˆì‹œ</h4>
                            <ul class="text-sm text-gray-600 list-disc list-inside">
                                <li>í•œ ë²ˆì˜ ì‹¤íŒ¨ê°€ ì „ë¶€ëŠ” ì•„ë‹ˆì•¼</li>
                                <li>ì‹¤ìˆ˜ëŠ” ë°°ì›€ì˜ ê¸°íšŒê°€ ë  ìˆ˜ ìˆì–´</li>
                                <li>ëª¨ë“  ì‚¬ëŒì€ ê°ìì˜ ì†ë„ê°€ ìˆì–´</li>
                            </ul>
                        </div>
                        
                        <div class="bg-cyan-50 p-3 rounded-lg">
                            <h4 class="font-bold text-cyan-600 mb-1">ğŸ¯ êµ¬ì²´ì ì¸ ë„ì›€ ë°©ë²• ì˜ˆì‹œ</h4>
                            <ul class="text-sm text-gray-600 list-disc list-inside">
                                <li>ë§¤ì¼ ì¡°ê¸ˆì”© ì—°ìŠµí•˜ê¸°</li>
                                <li>ë„ì›€ì„ ìš”ì²­í•˜ê¸°</li>
                                <li>ì‘ì€ ëª©í‘œë¶€í„° ì‹œì‘í•˜ê¸°</li>
                                <li>ì„±ê³µ ê²½í—˜ì„ ê¸°ë¡í•˜ê¸°</li>
                            </ul>
                        </div>
                        
                        <div class="bg-yellow-50 p-3 rounded-lg">
                            <h4 class="font-bold text-yellow-600 mb-1">ğŸ’¡ ì²´í¬ë¦¬ìŠ¤íŠ¸ í™œìš© íŒ</h4>
                            <ul class="text-sm text-gray-600 list-disc list-inside">
                                <li>ì¹œêµ¬ì˜ ìƒí™©ì— ë§ëŠ” í•­ëª©ë“¤ì„ ì„ íƒí•˜ì„¸ìš”</li>
                                <li>"ì ìš©í•˜ê¸°" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìë™ìœ¼ë¡œ í…ìŠ¤íŠ¸ê°€ ì…ë ¥ë©ë‹ˆë‹¤</li>
                                <li>í•„ìš”ì— ë”°ë¼ ë‚´ìš©ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ì¶”ê°€í•˜ì„¸ìš”</li>
                                <li>ìƒí™©ë³„ë¡œ ë‹¤ë¥¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ê°€ ì œê³µë©ë‹ˆë‹¤</li>
                            </ul>
                        </div>
                    </div>
                `;
                
                modal.classList.remove('hidden');
            },
            
            // ëª¨ë‹¬ ë‹«ê¸°
            hideModal() {
                document.getElementById('help-modal').classList.add('hidden');
            },
            
            // ì•Œë¦¼ í‘œì‹œ
            showNotification(message) {
                const notification = document.getElementById('notification');
                const text = document.getElementById('notification-text');
                
                text.textContent = message;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            },
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥
            saveToLocalStorage() {
                try {
                    const data = {
                        state: this.state,
                        formData: {
                            counselorName: document.getElementById('counselor-name').value,
                            clientName: document.getElementById('client-name').value,
                            empathy: document.getElementById('empathy-text').value,
                            newThinking: document.getElementById('new-thinking').value,
                            helpSuggestions: document.getElementById('help-suggestions').value,
                            personalEncouragement: document.getElementById('personal-encouragement').value,
                            promise: document.getElementById('promise-checkbox').checked
                        },
                        timestamp: new Date().toISOString()
                    };
                    
                    localStorage.setItem('abc_friend_helper_data', JSON.stringify(data));
                } catch (error) {
                    console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                }
            },
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë³µì›
            restoreFromLocalStorage() {
                try {
                    const savedData = localStorage.getItem('abc_friend_helper_data');
                    if (!savedData) return;
                    
                    const data = JSON.parse(savedData);
                    
                    // 24ì‹œê°„ ì´ìƒ ì§€ë‚œ ë°ì´í„°ëŠ” ë¬´ì‹œ
                    const savedTime = new Date(data.timestamp);
                    const now = new Date();
                    const hoursDiff = (now - savedTime) / (1000 * 60 * 60);
                    
                    if (hoursDiff > 24) {
                        localStorage.removeItem('abc_friend_helper_data');
                        return;
                    }
                    
                    // ìƒíƒœ ë³µì›
                    this.state = { ...this.state, ...data.state };
                    
                    // í¼ ë°ì´í„° ë³µì›
                    if (data.formData.counselorName) document.getElementById('counselor-name').value = data.formData.counselorName;
                    if (data.formData.clientName) document.getElementById('client-name').value = data.formData.clientName;
                    if (data.formData.empathy) document.getElementById('empathy-text').value = data.formData.empathy;
                    if (data.formData.newThinking) document.getElementById('new-thinking').value = data.formData.newThinking;
                    if (data.formData.helpSuggestions) document.getElementById('help-suggestions').value = data.formData.helpSuggestions;
                    if (data.formData.personalEncouragement) document.getElementById('personal-encouragement').value = data.formData.personalEncouragement;
                    if (data.formData.promise) document.getElementById('promise-checkbox').checked = data.formData.promise;
                    
                    // UI ì—…ë°ì´íŠ¸
                    this.updateSelectedEmotions();
                    this.updateCurrentSituation();
                    document.querySelectorAll('.emotion-btn').forEach(btn => {
                        if (this.state.selectedEmotions.includes(btn.textContent)) {
                            btn.classList.add('selected');
                        }
                    });
                    
                    // ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
                    const category = this.state.currentCategory || 'í•™êµìƒí™œ';
                    this.loadSituationBasedChecklists(category);
                    
                    // í˜„ì¬ ë‹¨ê³„ë¡œ ì´ë™
                    this.goToStep(this.state.currentStep);
                    
                    this.showNotification('âœ… ì´ì „ ì‘ì—…ì´ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤');
                } catch (error) {
                    console.error('ë³µì› ì˜¤ë¥˜:', error);
                    localStorage.removeItem('abc_friend_helper_data');
                }
            },
            
            // ìë™ ì €ì¥
            autoSave() {
                this.saveToLocalStorage();
            }
        };
        
        // ì „ì—­ í•¨ìˆ˜ ë“±ë¡
        window.ABCHelper = ABCHelper;
        
        // DOM ë¡œë“œ ì™„ë£Œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            ABCHelper.init();
        });
    </script>
</body>
</html>